<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<title></title>
<meta name="Generator" content="Cocoa HTML Writer">
<meta name="CocoaVersion" content="1038.25">
<style type="text/css">
p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 15.0px Helvetica}
p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 15.0px Helvetica; min-height: 18.0px}
p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; font: 10.0px Futura}
p.p4 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; min-height: 12.0px}
p.p5 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Futura}
p.p6 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco}
p.p7 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #ad140d}
p.p8 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Futura; min-height: 15.0px}
p.p9 {margin: 0.0px 0.0px 0.0px 0.0px; font: 8.0px Monaco; color: #001bb9}
p.p10 {margin: 0.0px 0.0px 0.0px 0.0px; font: 16.0px Helvetica; min-height: 19.0px}
p.p11 {margin: 0.0px 0.0px 0.0px 0.0px; font: 16.0px Helvetica}
p.p12 {margin: 0.0px 0.0px 0.0px 0.0px; font: 13.0px Helvetica; min-height: 16.0px}
p.p13 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #2c7014}
p.p14 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #001bb9}
p.p15 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
span.s1 {color: #001bb9}
span.s2 {color: #2c7014}
span.s3 {color: #ad140d}
span.s4 {color: #000000}
span.s5 {font: 9.0px Monaco}
span.s6 {font: 12.0px Helvetica; color: #001bb9}
span.s7 {color: #606060}
span.Apple-tab-span {white-space:pre}
</style>
</head>
<body>
<p class="p1"><b>proxy space examples</b></p>
<p class="p2"><br></p>
<p class="p3">Overview: <a href="../JITLib.html"><span class="s1">JITLib</span></a></p>
<p class="p3">see also: <a href="../environments/ProxySpace.html"><span class="s1">ProxySpace</span></a></p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p4"><br></p>
<p class="p5">preparing the environment</p>
<p class="p4"><br></p>
<p class="p6">(</p>
<p class="p6">s.boot;</p>
<p class="p6">p = <span class="s1">ProxySpace</span>.push(s);</p>
<p class="p6">)</p>
<p class="p4"><br></p>
<p class="p5">playing and monitoring</p>
<p class="p4"><br></p>
<p class="p7">// play some output to the hardware busses, this could be any audio rate key.</p>
<p class="p6">~out.play;</p>
<p class="p4"><br></p>
<p class="p6">~out = { <span class="s1">SinOsc</span>.ar([400, 408] * 0.8, 0, 0.2) };</p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p7">// replacing the node. the crossfade envelope is created internally.</p>
<p class="p6">~out = { <span class="s1">SinOsc</span>.ar([443, 600 - <span class="s1">Rand</span>(0,200)], 0, 0.2) };</p>
<p class="p6">~out = { <span class="s1">Resonz</span>.ar(<span class="s1">Saw</span>.ar(40 + [0,0.2], 1), [1200, 1600], 0.1) + <span class="s1">SinOsc</span>.ar(60 * [1,1.1],0,0.2) };</p>
<p class="p6">~out = { <span class="s1">Pan2</span>.ar(<span class="s1">PinkNoise</span>.ar(0.1), <span class="s1">LFClipNoise</span>.kr(2)) };</p>
<p class="p4"><br></p>
<p class="p5">setting the node controls</p>
<p class="p4"><br></p>
<p class="p6">~out = { <span class="s1">arg</span> rate = 2; <span class="s1">Pan2</span>.ar(<span class="s1">PinkNoise</span>.ar(0.1), <span class="s1">LFClipNoise</span>.kr(rate)) };</p>
<p class="p6">~out.set(<span class="s2">\rate</span>, 30);</p>
<p class="p6">~out = { <span class="s1">arg</span> rate = 2; <span class="s1">Pan2</span>.ar(<span class="s1">Dust</span>.ar(2000, 0.2), <span class="s1">LFClipNoise</span>.kr(rate)) };</p>
<p class="p6">~out.set(<span class="s2">\rate</span>, 2);</p>
<p class="p4"><br></p>
<p class="p5">referencing between proxies</p>
<p class="p4"><br></p>
<p class="p6">~lfo = { <span class="s1">LFNoise2</span>.kr(30, 300, 500) };</p>
<p class="p6">~out = { <span class="s1">SinOsc</span>.ar(~lfo.kr, 0, 0.15)<span class="Apple-converted-space">  </span>};</p>
<p class="p6">~out = { <span class="s1">SinOsc</span>.ar(~lfo.kr * [1, 1.2], 0, 0.1) * <span class="s1">Pulse</span>.ar(~lfo.kr * [0.1, 0.125], 0.5) };</p>
<p class="p6">~lfo = { <span class="s1">LFNoise1</span>.kr(30, 40) + <span class="s1">SinOsc</span>.kr(0.1, 0, 200, 500) };</p>
<p class="p6">~out = { <span class="s1">SinOsc</span>.ar(~lfo.kr * [1, 1.2], 0, 0.1)<span class="Apple-converted-space">  </span>};</p>
<p class="p6">~lfo = 410;</p>
<p class="p4"><br></p>
<p class="p8"><br></p>
<p class="p5">math</p>
<p class="p4"><br></p>
<p class="p7">// unary operators</p>
<p class="p6">~lfo2 = { <span class="s1">SinOsc</span>.kr(0.5, 0, 600, 100)<span class="Apple-converted-space">  </span>};</p>
<p class="p6">~lfo = ~lfo2.abs;</p>
<p class="p6">~lfo2 = { <span class="s1">SinOsc</span>.kr(1.3, 0, 600, 100)<span class="Apple-converted-space">  </span>};</p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p7">// binary operators</p>
<p class="p6">~lfo3 = { <span class="s1">LFTri</span>.kr(0.5, 0, 80, 300) };</p>
<p class="p6">~lfo = ~lfo2 + ~lfo3;</p>
<p class="p6">~lfo = ~lfo3;</p>
<p class="p6">~lfo = (~lfo3 / 50).sin * 200 + 500 * { <span class="s1">LFTri</span>.kr(~lfo.kr * 0.0015, 0, 0.1 * ~lfo3.kr / 90, 1) };</p>
<p class="p6">~lfo3 = { <span class="s1">Mix</span>(~lfo2.kr * [1, 1.2]) };</p>
<p class="p4"><br></p>
<p class="p6">currentEnvironment.free; <span class="s3">// free all node proxies</span></p>
<p class="p7"><span class="s4">~out.stop; </span>// free the playback synth.</p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p5">waking up a network of proxies</p>
<p class="p4"><br></p>
<p class="p7">// hit cmd-. to stop all nodes</p>
<p class="p7">// start again</p>
<p class="p6">~out.play;<span class="Apple-converted-space"> </span></p>
<p class="p4"><br></p>
<p class="p5">feeding back (one buffer size delay)</p>
<p class="p4"><br></p>
<p class="p6">~out = { <span class="s1">SinOsc</span>.ar([220, 330], ~out.ar(2).reverse * <span class="s1">LFNoise2</span>.kr(0.5, 4pi), 0.4) };</p>
<p class="p4"><br></p>
<p class="p7">// there is no immediacy: hear the buffer size cycle</p>
<p class="p6">~out = { <span class="s1">Impulse</span>.ar(1 ! 2) + (~out.ar(2) * 0.99) };<span class="Apple-converted-space"> </span></p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p7">// supercollider 'differential equations'</p>
<p class="p4"><br></p>
<p class="p6">~out = { <span class="s1">SinOsc</span>.ar(<span class="s1">Slope</span>.ar(~out.ar) * <span class="s1">MouseX</span>.kr(1000, 18000, 1)) * 0.1 + <span class="s1">SinOsc</span>.ar(100, 0, 0.1) };</p>
<p class="p4"><br></p>
<p class="p6">(</p>
<p class="p6">~out = { <span class="s1">var</span> z, zz;</p>
<p class="p6"><span class="Apple-tab-span">	</span>z = <span class="s1">Slope</span>.ar(~out.ar);</p>
<p class="p6"><span class="Apple-tab-span">	</span>zz = <span class="s1">Slope</span>.ar(z);</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="s1">SinOsc</span>.ar(<span class="s1">Rand</span>(300,410), z) *</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="s1">SinOsc</span>.ar(zz * 410)<span class="Apple-converted-space"> </span></p>
<p class="p6"><span class="Apple-tab-span">	</span>* 0.1 + <span class="s1">Decay2</span>.ar(<span class="s1">Pan2</span>.ar(<span class="s1">Dust</span>.ar(600), <span class="s1">MouseX</span>.kr(-1,1)), 0.01, 0.05);</p>
<p class="p6">}</p>
<p class="p6">)</p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p5">multiple control</p>
<p class="p4"><br></p>
<p class="p6">(</p>
<p class="p6">~out = { <span class="s1">arg</span> freqOffest;</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="s1">var</span> ctl;</p>
<p class="p6"><span class="Apple-tab-span">	</span>ctl = <span class="s1">Control</span>.names(<span class="s2">\array</span>).kr(<span class="s1">Array</span>.rand(8, 400, 1000));</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="s1">Pan2</span>.ar(<span class="s1">Mix</span>(<span class="s1">SinOsc</span>.ar(ctl + freqOffest, 0, 0.1 / 8)), <span class="s1">LFNoise0</span>.kr(2))</p>
<p class="p6">};</p>
<p class="p6">)<span class="Apple-tab-span">	</span></p>
<p class="p4"><br></p>
<p class="p6">~out.setn(<span class="s2">\array</span>, <span class="s1">Array</span>.exprand(8, 400, 2000));</p>
<p class="p6">~out.set(<span class="s2">\freqOffest</span>, rrand(300,200));</p>
<p class="p6">~out.map(<span class="s2">\freqOffest</span>, ~lfo);</p>
<p class="p4"><br></p>
<p class="p7">// a simpler short form for this is:</p>
<p class="p6">(</p>
<p class="p6">~out = { <span class="s1">arg</span> freqOffest=0, array = #[ 997, 777, 506, 553, 731, 891, 925, 580 ];</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="s1">Pan2</span>.ar(<span class="s1">Mix</span>(<span class="s1">SinOsc</span>.ar(array + freqOffest, 0, 0.1 / 8)), <span class="s1">LFNoise0</span>.kr(2))</p>
<p class="p6">};</p>
<p class="p6">)</p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p5">mixing</p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p6">~out1 = { <span class="s1">SinOsc</span>.ar(600, 0, 0.1) };</p>
<p class="p6">~out2 = { <span class="s1">SinOsc</span>.ar(500, 0, 0.1) };</p>
<p class="p6">~out3 = { <span class="s1">SinOsc</span>.ar(400, 0, 0.1) };</p>
<p class="p6">~out = ~out2 + ~out1 + ~out3;</p>
<p class="p4"><br></p>
<p class="p6">~out = ~out1 + ~out2;</p>
<p class="p6">~out = ~out1;</p>
<p class="p4"><br></p>
<p class="p7">// another way is:</p>
<p class="p6">~out = { <span class="s1">SinOsc</span>.ar(600, 0, 0.1) };</p>
<p class="p6">~out.add({ <span class="s1">SinOsc</span>.ar(500, 0, 0.1) });</p>
<p class="p6">~out.add({ <span class="s1">SinOsc</span>.ar(400, 0, 0.1) });</p>
<p class="p4"><br></p>
<p class="p7">// or with direct access:</p>
<p class="p6">~out[1] = { <span class="s1">SinOsc</span>.ar(500 * 1.2, 0, 0.1) };</p>
<p class="p6">~out[2] = { <span class="s1">SinOsc</span>.ar(400 * 1.2, 0, 0.1) };</p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p5">restoring / erasing</p>
<p class="p4"><br></p>
<p class="p7"><span class="s4">~out.free; </span>// this frees the group, not the play synth x</p>
<p class="p7"><span class="s4">~out.send; </span>// resends all synths</p>
<p class="p6">~out.free;<span class="Apple-converted-space"> </span></p>
<p class="p7"><span class="s4">~out.send(</span><span class="s1">nil</span><span class="s4">, 1); </span>// this sends at index 1 only<span class="Apple-converted-space"> </span></p>
<p class="p6">~out.send;</p>
<p class="p4"><br></p>
<p class="p7">// removing:</p>
<p class="p6">~out.removeLast;</p>
<p class="p6">~out.removeAt(0);</p>
<p class="p4"><br></p>
<p class="p7">// cleaning up, freeing the bus:</p>
<p class="p7"><span class="s4">~out.clear; </span>// this neutralizes the proxy, and frees its bus</p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p5">for more on the proxy slots see:<span class="s5"> <a href="jitlib_basic_concepts_03.html"><span class="s6">jitlib_basic_concepts_03</span></a><span class="Apple-converted-space"> </span></span></p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p5">garbage collecting</p>
<p class="p4"><br></p>
<p class="p7">// often there are proxies playing that are not used anymore - this is good,</p>
<p class="p7">// because they might be used again at any time.<span class="Apple-converted-space"> </span></p>
<p class="p7">// this shows how to free unused proxies, such as ~out1, ~out2. <span class="Apple-converted-space"> </span></p>
<p class="p4"><br></p>
<p class="p6">~out.play;</p>
<p class="p6">~out = { <span class="s1">Pan2</span>.ar(<span class="s1">SinOsc</span>.ar(~lfo.kr, 0, 0.2), sin(~lfo.kr / 10)) }; <span class="s3">// ~lfo is kept, as its parents.</span></p>
<p class="p6">~lfo = { <span class="s1">LFNoise2</span>.kr(3, 160, 400) };</p>
<p class="p4"><br></p>
<p class="p6">p.keysValuesDo { <span class="s1">arg</span> key, proxy; [key, proxy.isPlaying].postln };</p>
<p class="p7"><span class="s4">p.reduce; </span>// all monitoring proxies (in this case ~out) are kept running.</p>
<p class="p7">//<span class="Apple-converted-space">  </span>equivalent: p.reduce(to: [~out]);</p>
<p class="p6">p.keysValuesDo { <span class="s1">arg</span> key, proxy; [key, proxy.isPlaying].postln };</p>
<p class="p4"><br></p>
<p class="p7">// to remove everything else:</p>
<p class="p6">p.postln;</p>
<p class="p7"><span class="s4">p.clean; </span>// all monitoring proxies (in this case ~out) are kept.</p>
<p class="p6">p.postln;</p>
<p class="p4"><br></p>
<p class="p7">// after ~out is stopped, it is removed, too:</p>
<p class="p7"><span class="s4">~out.stop; </span>// stop monitor</p>
<p class="p6">p.clean;<span class="Apple-converted-space"> </span></p>
<p class="p7"><span class="s4">p.postln; </span>// empty space.</p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p5">execution order</p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p7">// you can .play .kr or .ar also a name that is not yet used.</p>
<p class="p7">// the rate is guessed as far as possible. on this topic see also: [the_lazy_proxy]</p>
<p class="p4"><br></p>
<p class="p7"><span class="s4">~myOut.play; </span>// play some key (audio rate is assumed)</p>
<p class="p4"><br></p>
<p class="p7">// the rate is determined from the first access:<span class="Apple-converted-space"> </span></p>
<p class="p7">// like this ~lfo becomes control rate</p>
<p class="p4"><br></p>
<p class="p6">~myOut = { <span class="s1">SinOsc</span>.ar(~freq.kr * 2, 0, 0.1) };<span class="Apple-converted-space"> </span></p>
<p class="p6">~freq = 900;</p>
<p class="p6">~freq = { <span class="s1">SinOsc</span>.kr(115, 0, 70, 220) }</p>
<p class="p4"><br></p>
<p class="p6">~myOut = { <span class="s1">SinOsc</span>.ar(~otherFreq.ar * 2, 0, 0.1) };</p>
<p class="p6">~otherFreq = { <span class="s1">SinOsc</span>.ar(115, 0, 70, 220) };</p>
<p class="p4"><br></p>
<p class="p7"><span class="s4">currentEnvironment.clear; </span>// clear every<span class="Apple-converted-space">  </span>proxy in this environment and remove them. (same: p.clear)</p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p5">setting the xfade time</p>
<p class="p4"><br></p>
<p class="p6">~out.play;</p>
<p class="p4"><br></p>
<p class="p6">~out.fadeTime = 4;</p>
<p class="p6">~out = { <span class="s1">SinOsc</span>.ar(<span class="s1">Rand</span>(800, 300.0) * [1,1.1], 0, 0.1) };</p>
<p class="p6">~out = { <span class="s1">SinOsc</span>.ar(<span class="s1">Rand</span>(800, 300.0) * [1,1.1], 0, 0.1) };</p>
<p class="p6">~out.fadeTime = 0.01;</p>
<p class="p6">~out = { <span class="s1">SinOsc</span>.ar(<span class="s1">Rand</span>(800, 300.0) * [1,1.1], 0, 0.1) };</p>
<p class="p6">~out = { <span class="s1">SinOsc</span>.ar(<span class="s1">Rand</span>(800, 300.0) * [1,1.1], 0, 0.1) };</p>
<p class="p4"><br></p>
<p class="p7"><span class="s4">~out.free(3);<span class="Apple-converted-space">  </span></span>// release the synths and the group with a given fadeTime without changing proxy time</p>
<p class="p7"><span class="s4">~out.stop;<span class="Apple-tab-span">	</span></span>// stop monitor</p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p5">setting and mapping arguments</p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p6">~out.play;</p>
<p class="p4"><br></p>
<p class="p6">~out = { <span class="s1">arg</span> freq=500, ffreq=120; <span class="s1">SinOsc</span>.ar(freq*[1,1.1], <span class="s1">SinOsc</span>.ar(ffreq, 0, pi), 0.2) };</p>
<p class="p6">~out.set(<span class="s2">\freq</span>, 400 + 100.rand2);</p>
<p class="p6">~out.set(<span class="s2">\freq</span>, 400 + 100.rand2);</p>
<p class="p6">~out.set(<span class="s2">\ffreq</span>, 30 + 20.rand2);</p>
<p class="p7"><span class="s4">~out.unset(</span><span class="s2">\freq</span><span class="s4">, </span><span class="s2">\ffreq</span><span class="s4">);<span class="Apple-converted-space">  </span></span>// remove the setting</p>
<p class="p6">~out.set(<span class="s2">\ffreq</span>, 30 + 10.rand2, <span class="s2">\freq</span>, 500 + 200.rand2);</p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p7">// argument settings and mappings are applied to every new function</p>
<p class="p6">~out = { <span class="s1">arg</span> freq=100, ffreq=20; <span class="s1">SinOsc</span>.ar(freq, <span class="s1">SinOsc</span>.ar(<span class="s1">SinOsc</span>.ar(ffreq)*ffreq, 0, pi), 0.2) };</p>
<p class="p4"><br></p>
<p class="p7">// mapping to other proxies</p>
<p class="p6">~lfo = { <span class="s1">SinOsc</span>.kr(0.3, 0, 80, 100) };</p>
<p class="p6">~out.map(<span class="s2">\ffreq</span>, ~lfo);</p>
<p class="p4"><br></p>
<p class="p6">~out = { <span class="s1">arg</span> freq=300, ffreq=20; <span class="s1">Pulse</span>.ar(freq * [1, 1.1] + <span class="s1">SinOsc</span>.ar(ffreq, 0, freq), 0.3, 0.1) };</p>
<p class="p6">~out = { <span class="s1">arg</span> freq=300, ffreq=20; <span class="s1">BPF</span>.ar(<span class="s1">LFSaw</span>.ar(ffreq * [1, 1.1], 0, 1), freq, 0.2) };</p>
<p class="p4"><br></p>
<p class="p6">~lfo = { <span class="s1">FSinOsc</span>.kr(0.3, 0, 30, 200) + <span class="s1">FSinOsc</span>.kr(10, 0, 10) };</p>
<p class="p6">~out = { <span class="s1">arg</span> freq=300, ffreq=20; <span class="s1">SinOsc</span>.ar(freq*[1,1.1], <span class="s1">SinOsc</span>.ar(ffreq, 0, pi), 0.1) };</p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p7">// crossfaded setting and mapping: fadeTime is used</p>
<p class="p6">~out.fadeTime = 2;</p>
<p class="p6">~out.xset(<span class="s2">\freq</span>, 9000);</p>
<p class="p6">~out.xset(<span class="s2">\freq</span>, rrand(400, 700));</p>
<p class="p4"><br></p>
<p class="p6">~lfo = { <span class="s1">FSinOsc</span>.kr(0.1, 0, 30, 100) };</p>
<p class="p6">~lfo2 = { <span class="s1">LFClipNoise</span>.kr(3, 100, 200) };</p>
<p class="p6">~lfo3 = <span class="s1">StreamKrDur</span>(<span class="s1">Pseq</span>([<span class="s1">Prand</span>([530, 600],1), 700, 400, 800, 500].scramble, <span class="s1">inf</span>) / 3, 0.2);</p>
<p class="p4"><br></p>
<p class="p6">~out.xmap(<span class="s2">\ffreq</span>, ~lfo2);</p>
<p class="p6">~out.xmap(<span class="s2">\ffreq</span>, ~lfo);</p>
<p class="p6">~out.xmap(<span class="s2">\ffreq</span>, ~lfo3);</p>
<p class="p4"><br></p>
<p class="p7">// argument rates: just like a synthdef has input 'rates' (like \ir or \tr), a nodeproxy control</p>
<p class="p7">// can be given a rate. this rate is used for each function passed into the proxy.</p>
<p class="p4"><br></p>
<p class="p7">// trigger inputs</p>
<p class="p6">~out = { <span class="s1">arg</span> trig, dt=1; <span class="s1">Decay2</span>.kr(trig, 0.01, dt) * <span class="s1">Mix</span>(<span class="s1">SinOsc</span>.ar(7000 * [1.2, 1.3, 0.2])) }</p>
<p class="p6">~out.setRates(<span class="s2">\trig</span>, <span class="s2">\tr</span>);</p>
<p class="p4"><br></p>
<p class="p7">// set the group, so the node proxy does not store the new value</p>
<p class="p6">~out.group.set(<span class="s2">\trig</span>, 0.1, <span class="s2">\dt</span>, 0.1);<span class="Apple-converted-space"> </span></p>
<p class="p6">~out.group.set(<span class="s2">\trig</span>, 0.4, <span class="s2">\dt</span>, 0.31);</p>
<p class="p6">~out.group.set(<span class="s2">\trig</span>, 0.13, <span class="s2">\dt</span>, 2);</p>
<p class="p4"><br></p>
<p class="p7">// lagging controls:</p>
<p class="p7"><span class="s4">~out.lag(</span><span class="s2">\xfreq</span><span class="s4">, 1); </span>// equivalent to ~out.setRates(\xfreq, 1);</p>
<p class="p6">(</p>
<p class="p6">~out = { <span class="s1">arg</span> trig, dt=1, xfreq=700;<span class="Apple-converted-space"> </span></p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="s1">Decay2</span>.kr(trig, 0.01, dt) * <span class="s1">Mix</span>(<span class="s1">SinOsc</span>.ar(xfreq * [1.2, 1.3, 0.2]))<span class="Apple-converted-space"> </span></p>
<p class="p6">};</p>
<p class="p6">)</p>
<p class="p6">~out.group.set(<span class="s2">\trig</span>, 0.1, <span class="s2">\dt</span>, 1, <span class="s2">\xfreq</span>, rrand(2000,9000));<span class="Apple-converted-space"> </span></p>
<p class="p6">~out.group.set(<span class="s2">\trig</span>, 0.1, <span class="s2">\dt</span>, 0.5, <span class="s2">\xfreq</span>, rrand(2000,9000));<span class="Apple-converted-space"> </span></p>
<p class="p6">~out.group.set(<span class="s2">\trig</span>, 0.1, <span class="s2">\dt</span>, 1, <span class="s2">\xfreq</span>, rrand(2000,9000));<span class="Apple-converted-space"> </span></p>
<p class="p4"><br></p>
<p class="p7">// changing the lag, the synth is reconstructed with the new lag:</p>
<p class="p4"><br></p>
<p class="p6">~out.lag(<span class="s2">\xfreq</span>, 0.01);</p>
<p class="p6">~out.group.set(<span class="s2">\trig</span>, 0.1, <span class="s2">\dt</span>, 1, <span class="s2">\xfreq</span>, rrand(2000,9000));<span class="Apple-converted-space"> </span></p>
<p class="p6">~out.group.set(<span class="s2">\trig</span>, 0.1, <span class="s2">\dt</span>, 1, <span class="s2">\xfreq</span>, rrand(2000,9000));<span class="Apple-converted-space"> </span></p>
<p class="p6">~out.group.set(<span class="s2">\trig</span>, 0.1, <span class="s2">\dt</span>, 1, <span class="s2">\xfreq</span>, rrand(2000,9000));<span class="Apple-converted-space"> </span></p>
<p class="p4"><br></p>
<p class="p7">// removing the trig rate:</p>
<p class="p6">~out.setRates(<span class="s2">\trig</span>, <span class="s1">nil</span>);</p>
<p class="p4"><br></p>
<p class="p7">// note that the same works with the i_ and the t_ arguments, just as it does in SynthDef</p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p9"><span class="s4"><span class="Apple-converted-space">                          </span></span>_____________________________________________________________________________________________</p>
<p class="p10"><br></p>
<p class="p10"><br></p>
<p class="p10"><br></p>
<p class="p11">other possible inputs</p>
<p class="p12"><br></p>
<p class="p4"><br></p>
<p class="p5">using a synthdef as input</p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p7">// for a more systematic overview see: [jitlib_fading]</p>
<p class="p4"><br></p>
<p class="p7">// you have the responsibility for the right number of channels and output rate</p>
<p class="p7">// you have to supply an 'out' argument so it can be mapped to the right channel.</p>
<p class="p4"><br></p>
<p class="p6">~out.play;</p>
<p class="p6">~out = <span class="s1">SynthDef</span>(<span class="s7">"w"</span>, { <span class="s1">arg</span> out=0; <span class="s1">Out</span>.ar(out,<span class="s1">SinOsc</span>.ar([<span class="s1">Rand</span>(430, 600), 600], 0, 0.2)) });</p>
<p class="p6">~out = <span class="s1">SynthDef</span>(<span class="s7">"w"</span>, { <span class="s1">arg</span> out=0; <span class="s1">Out</span>.ar(out,<span class="s1">SinOsc</span>.ar([<span class="s1">Rand</span>(430, 600), 500], 0, 0.2)) });</p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p7">// if you supply a gate it fades in and out. evaluate this several times</p>
<p class="p6">(</p>
<p class="p6">~out = <span class="s1">SynthDef</span>(<span class="s7">"w"</span>, { <span class="s1">arg</span> out=0, gate=1.0;<span class="Apple-converted-space"> </span></p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="s1">Out</span>.ar(out,</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s1">SinOsc</span>.ar([<span class="s1">Rand</span>(430, 800), <span class="s1">Rand</span>(430, 800)], 0, 0.2)<span class="Apple-converted-space"> </span></p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>* <span class="s1">EnvGen</span>.kr(<span class="s1">Env</span>.asr(1,1,1), gate, doneAction:2)</p>
<p class="p6"><span class="Apple-tab-span">	</span>)<span class="Apple-converted-space"> </span></p>
<p class="p6"><span class="Apple-tab-span">	</span>});</p>
<p class="p6">)</p>
<p class="p4"><br></p>
<p class="p7">// once the SynthDef is sent, it can be assigned by name.<span class="Apple-converted-space"> </span></p>
<p class="p7">// using this method, a gate argument should be<span class="Apple-converted-space"> </span></p>
<p class="p7">// provided that releases the synth. (doneAction:2)</p>
<p class="p7">// this is very efficient, as the def is on the server already.</p>
<p class="p4"><br></p>
<p class="p7">// if the synth def is in the synthdesc lib (.add) its gate is detected.</p>
<p class="p4"><br></p>
<p class="p6">(</p>
<p class="p6"><span class="s1">SynthDef</span>(<span class="s7">"staub"</span>, { <span class="s1">arg</span> out, gate=1;<span class="Apple-converted-space"> </span></p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="s1">Out</span>.ar(out,<span class="Apple-converted-space"> </span></p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s1">Ringz</span>.ar(<span class="s1">Dust</span>.ar(15), <span class="s1">Rand</span>(1, 3) * 3000*[1,1], 0.001)<span class="Apple-converted-space"> </span></p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>* <span class="s1">EnvGen</span>.kr(<span class="s1">Env</span>.asr, gate, doneAction:2)</p>
<p class="p6"><span class="Apple-tab-span">	</span>)<span class="Apple-converted-space"> </span></p>
<p class="p6">}).add;</p>
<p class="p6">)</p>
<p class="p4"><br></p>
<p class="p6">~out = <span class="s2">\staub</span>;</p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p7">// if you supply an envelope that frees itself, no bundle is sent to free it</p>
<p class="p6">(</p>
<p class="p6">~out = <span class="s1">SynthDef</span>(<span class="s7">"w"</span>, { <span class="s1">arg</span> out, lfo, f0=430;</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="s1">Out</span>.ar(out,</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s1">SinOsc</span>.ar([<span class="s1">Rand</span>(f0, 800), <span class="s1">Rand</span>(f0, 800)]+lfo, 0, 0.2)<span class="Apple-converted-space"> </span></p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>* <span class="s1">EnvGen</span>.kr(<span class="s1">Env</span>.perc(0.01, 0.03), doneAction:2)</p>
<p class="p6"><span class="Apple-tab-span">	</span>)<span class="Apple-converted-space"> </span></p>
<p class="p6"><span class="Apple-tab-span">	</span>});</p>
<p class="p6">)</p>
<p class="p4"><br></p>
<p class="p6">~out.spawn;</p>
<p class="p6">~out.spawn([<span class="s2">\f0</span>, 5000]);</p>
<p class="p6">fork { 5.do { ~out.spawn([<span class="s2">\f0</span>, 5000 + 1000.0.rand]); 0.1.wait; } }</p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p7">// when the synth description in the SynthDescLib is found for the symbol,</p>
<p class="p7">// the proxy can determine whether to release or to free the synth.</p>
<p class="p7">// so if there is no 'gate' arg provided and the def has a desc, the synth is</p>
<p class="p7">// freed and not released.<span class="Apple-converted-space"> </span></p>
<p class="p4"><br></p>
<p class="p6">(</p>
<p class="p6"><span class="s1">SynthDef</span>(<span class="s7">"staub"</span>, { <span class="s1">arg</span> out;<span class="Apple-converted-space"> </span></p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="s1">Out</span>.ar(out, <span class="s1">Ringz</span>.ar(<span class="s1">WhiteNoise</span>.ar(0.01), 1000 * [1,1], 0.001))<span class="Apple-converted-space"> </span></p>
<p class="p7"><span class="s4">}).add; </span>// store the synth def so it is added to the SynthDescLib</p>
<p class="p6">)</p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p6">~out = <span class="s2">\staub</span>;</p>
<p class="p7"><span class="s4">~out = </span><span class="s2">\staub</span><span class="s4">; </span>// watching the synth count shows that the old synth is freed.</p>
<p class="p7"><span class="s4">~out = 0;<span class="Apple-converted-space">  <span class="Apple-tab-span">	</span></span></span>// now out plays continuous stream of zero.</p>
<p class="p7"><span class="s4">~out = </span><span class="s1">nil</span><span class="s4">;<span class="Apple-tab-span">	</span></span>// removes object and stops it.</p>
<p class="p8"><br></p>
<p class="p5">using patterns</p>
<p class="p4"><br></p>
<p class="p7">// example</p>
<p class="p4"><br></p>
<p class="p6">(</p>
<p class="p6"><span class="s1">SynthDef</span>(<span class="s2">\who</span>, { <span class="s1">arg</span> amp=0.1, freq=440, detune=0, gate=1, out=0, ffreq=800;</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="s1">var</span> env;</p>
<p class="p6"><span class="Apple-tab-span">	</span>env = <span class="s1">Env</span>.asr(0.01, amp, 0.5);</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="s1">Out</span>.ar(out, <span class="s1">Pan2</span>.ar(</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s1">Formant</span>.ar(freq + detune, ffreq, 30, <span class="s1">EnvGen</span>.kr(env, gate, doneAction:2)), <span class="s1">Rand</span>(-1.0, 1.0))</p>
<p class="p6"><span class="Apple-tab-span">	</span>)</p>
<p class="p6">}).add;</p>
<p class="p4"><br></p>
<p class="p6">)</p>
<p class="p4"><br></p>
<p class="p6">~out.play;</p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p6">~out = <span class="s1">Pbind</span>(<span class="s2">\instrument</span>, <span class="s2">\who</span>, <span class="s2">\freq</span>, [600, 601], <span class="s2">\ffreq</span>, 800, <span class="s2">\legato</span>, 0.02);</p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p7">// embed a control node proxy into an event pattern:</p>
<p class="p7">// this does not work for indirect assignment as \degree, \midinote, etc.,<span class="Apple-converted-space"> </span></p>
<p class="p7">// because there is calculations in the event! if needed, these can be done in the SynthDef.</p>
<p class="p4"><br></p>
<p class="p6">~lfo = { <span class="s1">SinOsc</span>.kr(2, 0, 400, 700) };</p>
<p class="p6">~out = <span class="s1">Pbind</span>(<span class="s2">\instrument</span>, <span class="s2">\who</span>, <span class="s2">\freq</span>, 500, <span class="s2">\ffreq</span>, ~lfo, <span class="s2">\legato</span>, 0.02);</p>
<p class="p4"><br></p>
<p class="p6">~lfo = { <span class="s1">SinOsc</span>.kr(<span class="s1">SinOsc</span>.kr(0.2, <span class="s1">Rand</span>(0,pi), 10, 10), 0, 400, 700) };</p>
<p class="p4"><br></p>
<p class="p6">~lfo = { <span class="s1">LFNoise1</span>.kr(5, 1300, 1500) };</p>
<p class="p6">~lfo = { <span class="s1">MouseX</span>.kr(100, 5500, 1) };</p>
<p class="p4"><br></p>
<p class="p6">(</p>
<p class="p6">~out = <span class="s1">Pbind</span>(</p>
<p class="p13"><span class="s4"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\instrument<span class="s4">, </span>\who<span class="s4">,</span></p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s2">\freq</span>, <span class="s1">Pseq</span>([500, 380, 300],<span class="s1">inf</span>),</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s2">\legato</span>, 0.1,</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s2">\ffreq</span>, <span class="s1">Pseq</span>([~lfo, 100, ~lfo, 100, 300, 550], <span class="s1">inf</span>), <span class="s3">// use it in a pattern</span></p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s2">\dur</span>, <span class="s1">Pseq</span>([1, 0.5, 0.75, 0.125]*0.4, <span class="s1">inf</span>)</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>);</p>
<p class="p6">)</p>
<p class="p4"><br></p>
<p class="p7">// note that when you use a proxy within a non-event pattern it gets embedded as an object,</p>
<p class="p7">// so this functionality is still standard</p>
<p class="p4"><br></p>
<p class="p7">// works only with control rate proxies. multichannel control rate proxies cause</p>
<p class="p7">// multichannel expansion of the events:</p>
<p class="p4"><br></p>
<p class="p6">~lfoStereo = { <span class="s1">LFNoise1</span>.kr([1, 1], 1300, 1500) }; <span class="s3">// 2 channel control rate proxy</span></p>
<p class="p6">~out = <span class="s1">Pbind</span>(<span class="s2">\instrument</span>, <span class="s2">\who</span>, <span class="s2">\ffreq</span>, ~lfoStereo, <span class="s2">\legato</span>, 0.02).trace;</p>
<p class="p6">~lfoStereo = { [<span class="s1">MouseX</span>.kr(100, 15500, 1), <span class="s1">SinOsc</span>.kr(<span class="s1">SinOsc</span>.kr(0.2, 0, 10, 10), 0, 400, 700)] }</p>
<p class="p4"><br></p>
<p class="p7">// btw: setting the clock will cause the pattern to sync:</p>
<p class="p6">p.clock = <span class="s1">TempoClock</span>.default;</p>
<p class="p6">p.clock.tempo = 2.0;</p>
<p class="p6">p.clock.tempo = 1.0</p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p7">// patterns also crossfade, if an \amp arg is defined in the synthdef:</p>
<p class="p7">// (evaluate a couple of times)</p>
<p class="p6">~out.fadeTime = 3.0;</p>
<p class="p6">(</p>
<p class="p6">~out = <span class="s1">Pbind</span>(</p>
<p class="p13"><span class="s4"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\instrument<span class="s4">, </span>\who<span class="s4">,</span></p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s2">\freq</span>, <span class="s1">Pshuf</span>([500, 380, 200, 510, 390, 300, 300],<span class="s1">inf</span>) * rrand(1.0, 2.0),</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s2">\legato</span>, 0.1,</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s2">\ffreq</span>, <span class="s1">Pshuf</span>([~lfo, 100, ~lfo, 100, 300, 550], <span class="s1">inf</span>),</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s2">\dur</span>, 0.125 * [1, 2, 3, 2/3].choose</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>);</p>
<p class="p6">)</p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p5">using instruments and players</p>
<p class="p4"><br></p>
<p class="p7">// pause and resume do not work yet.</p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p7">// store an instrument</p>
<p class="p6">(</p>
<p class="p14">Instr<span class="s4">(</span><span class="s2">\test</span><span class="s4">,<span class="Apple-converted-space"> </span></span></p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>{ <span class="s1">arg</span> dens=520, ffreq=7000; <span class="s1">Ringz</span>.ar(<span class="s1">Dust</span>.ar(dens, [1,1] * 0.1), ffreq, 0.02) }</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>);</p>
<p class="p6">)</p>
<p class="p4"><br></p>
<p class="p6">~out = <span class="s1">Patch</span>(<span class="s2">\test</span>, [10, rrand(5000, 8000)]);</p>
<p class="p6">~out.fadeTime = 3;</p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p6">(</p>
<p class="p6">~out = <span class="s1">InstrSpawner</span>({ <span class="s1">arg</span> freq=1900,env,pan;</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="s1">Pan2</span>.ar(<span class="s1">SinOsc</span>.ar(freq, 0.5pi, 0.3) * <span class="s1">EnvGen</span>.kr(env, doneAction: 2), pan)</p>
<p class="p6">},[</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="s1">Prand</span>([1500, 700, 800, 3000] + 170.rand2, <span class="s1">inf</span>),</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="s1">Env</span>.perc(0.002,0.01),</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="s1">Prand</span>([-1,1],<span class="s1">inf</span>)</p>
<p class="p6">],0.125)</p>
<p class="p6">)</p>
<p class="p4"><br></p>
<p class="p6">~out.clear;</p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p7">// does not work (yet).</p>
<p class="p7">//~out.set(\dens, 120);</p>
<p class="p7">//~out.xset(\dens, 1030);<span class="Apple-converted-space"> </span></p>
<p class="p7">//~out.unmap(\ffreq);</p>
<p class="p7">//~out.set(\ffreq, 500);</p>
<p class="p12"><br></p>
<p class="p12"><br></p>
<p class="p9"><span class="s4"><span class="Apple-converted-space">                          </span></span>_____________________________________________________________________________________________</p>
<p class="p10"><br></p>
<p class="p10"><br></p>
<p class="p11">client side routines</p>
<p class="p12"><br></p>
<p class="p5">spawning<span class="Apple-converted-space"> </span></p>
<p class="p4"><br></p>
<p class="p6">~out.play;</p>
<p class="p7"><span class="s4">~out.awake = </span><span class="s1">false</span><span class="s4">; </span>// allow sound object assignment without immediate sending</p>
<p class="p4"><br></p>
<p class="p7">// putting an synthdef into the node proxy without playing it right away</p>
<p class="p7">// the synthdef has an envelope that frees by itself.</p>
<p class="p6">(</p>
<p class="p6">~out = <span class="s1">SynthDef</span>(<span class="s7">"a"</span>, { <span class="s1">arg</span> out=0, freq=800, pmf=1.0, pan;</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s1">var</span> env, u;</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>env = <span class="s1">EnvGen</span>.kr(<span class="s1">Env</span>.perc(0.001, 0.04, 0.4),doneAction:2); <span class="s3">// envelope</span></p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>u = <span class="s1">SinOsc</span>.ar(freq * <span class="s1">Rand</span>(0.9, 1.1), <span class="s1">SinOsc</span>.ar(pmf, 0, pi), env);</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s1">Out</span>.ar(out, <span class="s1">Pan2</span>.ar(u, pan))</p>
<p class="p6"><span class="Apple-tab-span">	</span>})</p>
<p class="p6">);</p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p7">// create a task to repeatedly send grains</p>
<p class="p6">(</p>
<p class="p6">t = <span class="s1">Task</span>.new({</p>
<p class="p6"><span class="Apple-tab-span">	</span>loop({</p>
<p class="p7"><span class="s4"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>// starts a synth with the current synthdef at index 0</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>~out.spawn([<span class="s2">\pmf</span>, [1, 20, 300].choose, <span class="s2">\pan</span>, [0, -1, 1].choose]);<span class="Apple-converted-space"> </span></p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>[0.1, 0.01, 0.25].choose.wait;</p>
<p class="p6"><span class="Apple-tab-span">	</span>})</p>
<p class="p6">});</p>
<p class="p6">)</p>
<p class="p4"><br></p>
<p class="p6">t.start;</p>
<p class="p6">t.stop;</p>
<p class="p6">t.start;</p>
<p class="p4"><br></p>
<p class="p7">// note: if you want to avoid using interpreter variables (single letter, like "t"),</p>
<p class="p7">// you can use Tdef for this. (see Tdef.help)</p>
<p class="p4"><br></p>
<p class="p7">// set some argument</p>
<p class="p6">~out.set(<span class="s2">\freq</span>, 300);</p>
<p class="p6">~out.set(<span class="s2">\freq</span>, 600);</p>
<p class="p6">~out.map(<span class="s2">\freq</span>, ~lfo);</p>
<p class="p6">~lfo = { <span class="s1">SinOsc</span>.kr(0.1, 0, 3000, 4000) };</p>
<p class="p6">~lfo = { <span class="s1">SinOsc</span>.kr(0.1, 0, 600, 700) };</p>
<p class="p6">~lfo.add({ <span class="s1">Trig</span>.kr(<span class="s1">Dust</span>.kr(1), 0.1) * 3000 });</p>
<p class="p6">~lfo = 300;</p>
<p class="p4"><br></p>
<p class="p7">// change the definition while going along</p>
<p class="p6">(</p>
<p class="p6">~out = <span class="s1">SynthDef</span>(<span class="s7">"a"</span>, { <span class="s1">arg</span> out, freq=800;</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s1">var</span> env;</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>env = <span class="s1">EnvGen</span>.kr(<span class="s1">Env</span>.perc(0.01, 0.1, 0.3),doneAction:2);</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s1">Out</span>.ar(out, <span class="s1">Pulse</span>.ar(freq * <span class="s1">Rand</span>([0.9,0.9], 1.1), 0.5, env) )</p>
<p class="p6"><span class="Apple-tab-span">	</span>});</p>
<p class="p6">)</p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p6">t.stop;</p>
<p class="p7"><span class="s4">~out.awake = </span><span class="s1">true</span><span class="s4">; </span>// don't forget this</p>
<p class="p7">//<span class="Apple-converted-space">  </span>free all synths in this current ProxySpace</p>
<p class="p6">currentEnvironment.clear;</p>
<p class="p12"><br></p>
<p class="p12"><br></p>
<p class="p12"><br></p>
<p class="p12"><br></p>
<p class="p9"><span class="s4"><span class="Apple-converted-space">                          </span></span>_____________________________________________________________________________________________</p>
<p class="p12"><br></p>
<p class="p12"><br></p>
<p class="p12"><br></p>
<p class="p5">granular synthesis: efficient code</p>
<p class="p4"><br></p>
<p class="p15">see also [jitlib_efficiency]</p>
<p class="p4"><br></p>
<p class="p6">~out.play;</p>
<p class="p12"><br></p>
<p class="p6">(</p>
<p class="p6"><span class="s1">SynthDef</span>(<span class="s7">"grain"</span>, { <span class="s1">arg</span> i_out = 0, pan;</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="s1">var</span> env;</p>
<p class="p6"><span class="Apple-tab-span">	</span>env = <span class="s1">EnvGen</span>.kr(<span class="s1">Env</span>.perc(0.001, 0.003, 0.2),doneAction:2);</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="s1">Out</span>.ar(i_out, <span class="s1">Pan2</span>.ar(<span class="s1">FSinOsc</span>.ar(<span class="s1">Rand</span>(1000,10000)), pan) * env)<span class="Apple-converted-space"> </span></p>
<p class="p6">}).send(s);</p>
<p class="p6">)</p>
<p class="p4"><br></p>
<p class="p7">// a target for the grains</p>
<p class="p7"><span class="s4">~someInput.ar(2);<span class="Apple-converted-space">  </span></span>// initialize to 2 channels audio</p>
<p class="p6">~out = ~someInput;</p>
<p class="p4"><br></p>
<p class="p6">(</p>
<p class="p6">t = <span class="s1">Task</span>({</p>
<p class="p6"><span class="Apple-tab-span">	</span>loop({</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>s.sendMsg(<span class="s7">"/s_new"</span>,<span class="s7">"grain"</span>,-1,0,0,<span class="Apple-converted-space"> </span></p>
<p class="p7"><span class="s4"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><span class="s2">\i_out</span><span class="s4">, ~someInput.index, </span>// returns the bus index of the proxy</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s2">\pan</span>, [1, 1, -1].choose * 0.2</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>); <span class="Apple-converted-space"> </span></p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>[0.01, 0.02].choose.wait;</p>
<p class="p6"><span class="Apple-tab-span">	</span>})</p>
<p class="p6">});</p>
<p class="p6">)</p>
<p class="p6">t.play;</p>
<p class="p4"><br></p>
<p class="p7">// different filters;</p>
<p class="p4"><br></p>
<p class="p6">~out.fadeTime = 1.0;</p>
<p class="p4"><br></p>
<p class="p6">~out = { <span class="s1">BPF</span>.ar(~someInput.ar, <span class="s1">MouseX</span>.kr(100, 18000, 1), 0.1) };</p>
<p class="p4"><br></p>
<p class="p6">~out = { <span class="s1">CombL</span>.ar(~someInput.ar * (<span class="s1">LFNoise0</span>.ar(2) &gt; 0), 0.2, 0.2, <span class="s1">MouseX</span>.kr(0.1, 5, 1)) };</p>
<p class="p4"><br></p>
<p class="p6">~out = { <span class="s1">RLPF</span>.ar(~someInput.ar, <span class="s1">LFNoise1</span>.kr(3, 1000, 1040), 0.05) };</p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p6">t.stop;</p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p7">// end</p>
<p class="p4"><br></p>
<p class="p6">~out.stop;</p>
<p class="p6">currentEnvironment.clear;</p>
<p class="p7"><span class="s1">ProxySpace</span><span class="s4">.pop; </span>// restore original environment</p>
<p class="p12"><br></p>
<p class="p12"><br></p>
<p class="p12"><br></p>
<p class="p9"><span class="s4"><span class="Apple-converted-space">                          </span></span>_____________________________________________________________________________________________</p>
<p class="p12"><br></p>
<p class="p12"><br></p>
<p class="p12"><br></p>
<p class="p5">using multiple proxyspaces</p>
<p class="p5">can be done while the server is not running: with p.wakeUp or p.play</p>
<p class="p5">the environment can be played back.</p>
<p class="p12"><br></p>
<p class="p7">// quit server:</p>
<p class="p4"><br></p>
<p class="p6">s.quit;</p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p7">// create two proxyspaces without a running server</p>
<p class="p6">(</p>
<p class="p14"><span class="s4">p = </span>ProxySpace<span class="s4">(s);</span></p>
<p class="p14"><span class="s4">q = </span>ProxySpace<span class="s4">(s);</span></p>
<p class="p4"><br></p>
<p class="p6">p.use({</p>
<p class="p6"><span class="Apple-tab-span">	</span>~out = { <span class="s1">Resonz</span>.ar(~in.ar, ~freq.kr, 0.01) };</p>
<p class="p6"><span class="Apple-tab-span">	</span>~in = { <span class="s1">WhiteNoise</span>.ar(0.5) };</p>
<p class="p6"><span class="Apple-tab-span">	</span>~freq = { <span class="s1">LFNoise2</span>.kr(1, 1000, 2000) };</p>
<p class="p6">});</p>
<p class="p4"><br></p>
<p class="p6">q.use({</p>
<p class="p4"><span class="Apple-tab-span">	</span></p>
<p class="p6"><span class="Apple-tab-span">	</span>~in = { <span class="s1">Dust</span>.ar(20, 0.1) };</p>
<p class="p6"><span class="Apple-tab-span">	</span>~out = { <span class="s1">Resonz</span>.ar(~in.ar * 450, ~freq.kr, 0.005) };</p>
<p class="p6"><span class="Apple-tab-span">	</span>~freq = { <span class="s1">LFNoise2</span>.kr(1, 400, 2000) };</p>
<p class="p6">});</p>
<p class="p6">)</p>
<p class="p4"><br></p>
<p class="p7">// wait for the booted<span class="Apple-converted-space">  </span>server</p>
<p class="p6">s.boot;</p>
<p class="p4"><br></p>
<p class="p7">// play the proxy at \out</p>
<p class="p6">p.play(<span class="s2">\out</span>);<span class="Apple-converted-space"> </span></p>
<p class="p7"><span class="s4">q.play; </span>// out is the default output</p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p5">external access</p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p6">q[<span class="s2">\in</span>][1] = { <span class="s1">Impulse</span>.ar(2, 0, 0.5) }; <span class="s3">// adding a synth at index 1</span></p>
<p class="p4"><br></p>
<p class="p7">// equivalent to</p>
<p class="p6">q.at(<span class="s2">\in</span>).put(1, { <span class="s1">Impulse</span>.ar(7, 0, 0.5) });</p>
<p class="p8"><br></p>
<p class="p4"><br></p>
<p class="p5">connecting two spaces (must be on one server)</p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p6">(</p>
<p class="p6">q.use({</p>
<p class="p6"><span class="Apple-tab-span">	</span>~freq =<span class="Apple-converted-space">  </span>100 + p[<span class="s2">\freq</span>] / 2;</p>
<p class="p6">})</p>
<p class="p6">)</p>
<p class="p4"><br></p>
<p class="p5">recording output (see also: [<a href="../nodeproxy/RecNodeProxy.html"><span class="s1">RecNodeProxy</span></a>])</p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p6">r = p.record(<span class="s2">\out</span>, <span class="s7">"proxySpace.aiff"</span>);</p>
<p class="p4"><br></p>
<p class="p7">// start recording</p>
<p class="p6">r.unpause;</p>
<p class="p4"><br></p>
<p class="p7">// pause recording</p>
<p class="p6">r.pause;</p>
<p class="p4"><br></p>
<p class="p7">// stop recording</p>
<p class="p6">r.close;</p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p5">push/pop</p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p7">// make p the currentEnvironment</p>
<p class="p6">p.push;<span class="Apple-converted-space"> </span></p>
<p class="p4"><br></p>
<p class="p6">~freq = 700;</p>
<p class="p6">~freq = 400;</p>
<p class="p6">~freq = { p.kr(<span class="s2">\freq</span>) + <span class="s1">LFNoise1</span>.kr(1, 200, 300) % 400 }; <span class="s3">// feedback</span></p>
<p class="p6">~freq = 400;</p>
<p class="p4"><br></p>
<p class="p7"><span class="s4">p.pop; </span>// restore environment</p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p7">// make y the currentEnvironment</p>
<p class="p6">q.push;<span class="Apple-converted-space"> </span></p>
<p class="p4"><br></p>
<p class="p6">~freq = 1000;</p>
<p class="p6">~in = { <span class="s1">WhiteNoise</span>.ar(0.01) };</p>
<p class="p4"><br></p>
<p class="p7"><span class="s4">q.pop; </span>// restore environment</p>
<p class="p4"><br></p>
<p class="p6">q.clear;</p>
<p class="p6">p.clear;</p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p9"><span class="s4"><span class="Apple-converted-space">                          </span></span>_____________________________________________________________________________________________</p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p5">some more topics</p>
<p class="p4"><br></p>
<p class="p5">nodeproxy with numbers as input:</p>
<p class="p4"><br></p>
<p class="p6">p = <span class="s1">ProxySpace</span>.push(s.boot);</p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p6">~out = { <span class="s1">SinOsc</span>.ar(~a.kr * <span class="s1">Rand</span>(1, 2), 0, 0.1) };</p>
<p class="p6">~out.play;</p>
<p class="p4"><br></p>
<p class="p6">~a = 900;</p>
<p class="p4"><br></p>
<p class="p7">// these add up:</p>
<p class="p6">~a[0] = 440;</p>
<p class="p6">~a[1] = 220;</p>
<p class="p6">~a[2] = 20;</p>
<p class="p4"><br></p>
<p class="p6">~a.fadeTime = 2;</p>
<p class="p4"><br></p>
<p class="p7"><span class="s4">~a[0] = 300; </span>// now there is a crossfade.</p>
<p class="p6">~a[1] = { <span class="s1">SinOsc</span>.kr(5, 0, 20) };<span class="Apple-converted-space"> </span></p>
<p class="p6">~a[2] = { <span class="s1">SinOsc</span>.kr(30, 0, 145) };</p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p7">// internally a numerical input is approximately replaced by:</p>
<p class="p7">// (pseudocode)</p>
<p class="p6"><span class="s1">SynthDef</span>(<span class="s7">"name"</span>, { <span class="s1">arg</span> out, fadeTime;</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="s1">Out</span>.kr(out,</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s1">Control</span>.kr(<span class="s1">Array</span>.fill(proxy.numChannels, { the number }))<span class="Apple-converted-space"> </span></p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>* <span class="s1">EnvGate</span>.new(fadeTime:fadeTime)</p>
<p class="p6"><span class="Apple-tab-span">	</span>)<span class="Apple-converted-space"> </span></p>
<p class="p6">});</p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p4"><br></p>
</body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<title></title>
<meta name="Generator" content="Cocoa HTML Writer">
<meta name="CocoaVersion" content="824.48">
<style type="text/css">
p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #bf0000}
p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #000000; min-height: 12.0px}
p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #000000}
p.p4 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #0000bf}
span.s1 {color: #0000bf}
span.s2 {color: #000000}
span.s3 {color: #007300}
span.s4 {color: #606060}
span.s5 {color: #bf0000}
span.Apple-tab-span {white-space:pre}
</style>
</head>
<body>
<p class="p1">// =====================================================================</p>
<p class="p1">// GeneralHIDSpec</p>
<p class="p1">// =====================================================================</p>
<p class="p2"><br></p>
<p class="p3"><span class="s1">GeneralHIDSpec</span> is a class to create access by names to slots of a <span class="s1">GeneralHIDDevice</span>.</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p1">// Look for the devices that are attached:</p>
<p class="p3"><span class="s1">GeneralHID</span>.buildDeviceList;</p>
<p class="p2"><br></p>
<p class="p1">// Get the list of devices:</p>
<p class="p3">d = <span class="s1">GeneralHID</span>.deviceList;</p>
<p class="p2"><br></p>
<p class="p1">// Check which devices have been found:</p>
<p class="p3"><span class="s1">GeneralHID</span>.postDevices;</p>
<p class="p2"><br></p>
<p class="p1">// Pick the 6th device and open it and create an instance of it:</p>
<p class="p3">a = <span class="s1">GeneralHID</span>.open( d[5] )</p>
<p class="p2"><br></p>
<p class="p1">// Get info on the device to see if it is the right one:</p>
<p class="p3">a.info;</p>
<p class="p2"><br></p>
<p class="p1">// Start eventloop:</p>
<p class="p3"><span class="s1">GeneralHID</span>.startEventLoop</p>
<p class="p2"><br></p>
<p class="p1">// Get the capabilities of the device in a readable format:</p>
<p class="p3">a.caps;</p>
<p class="p2"><br></p>
<p class="p1">// See if data is coming in:</p>
<p class="p3">a.debug_( <span class="s1">true</span> );</p>
<p class="p2"><br></p>
<p class="p1">// make an instance of a spec:</p>
<p class="p3">b = <span class="s1">GeneralHIDSpec</span>.new( a );</p>
<p class="p2"><br></p>
<p class="p1"><span class="s2">( </span>// defining the spec.</p>
<p class="p1">// trick: look at the debug output, by using each input thing on the gamepad and use the first two numbers posted as indexes</p>
<p class="p1">// example output of debug: [ 3, 2, 0.49803921568627, nil ]</p>
<p class="p1">// as a result of moving the y-axis of the right joystick.</p>
<p class="p1">// so we create this slot:</p>
<p class="p3">b.add( <span class="s3">\ry</span>, [3,2] );</p>
<p class="p2"><br></p>
<p class="p1">// and so on...</p>
<p class="p3">b.add( <span class="s3">\lx</span>, [3,0] );</p>
<p class="p3">b.add( <span class="s3">\ly</span>, [3,1] );</p>
<p class="p3">b.add( <span class="s3">\rx</span>, [3,5] );</p>
<p class="p2"><br></p>
<p class="p3">b.add( <span class="s3">\b1</span>, [1,288] );</p>
<p class="p3">b.add( <span class="s3">\b2</span>, [1,289] );</p>
<p class="p3">b.add( <span class="s3">\b3</span>, [1,290] );</p>
<p class="p3">b.add( <span class="s3">\b4</span>, [1,291] );</p>
<p class="p3">b.add( <span class="s3">\b5</span>, [1,292] );</p>
<p class="p3">b.add( <span class="s3">\b6</span>, [1,293] );</p>
<p class="p3">b.add( <span class="s3">\b7</span>, [1,294] );</p>
<p class="p3">b.add( <span class="s3">\b8</span>, [1,295] );</p>
<p class="p2"><br></p>
<p class="p3">b.add( <span class="s3">\b5</span>, [1,292] );</p>
<p class="p3">b.add( <span class="s3">\b6</span>, [1,293] );</p>
<p class="p3">b.add( <span class="s3">\b7</span>, [1,294] );</p>
<p class="p3">b.add( <span class="s3">\b8</span>, [1,295] );</p>
<p class="p2"><br></p>
<p class="p3">b.add( <span class="s3">\cx</span>, [3,16] );</p>
<p class="p3">b.add( <span class="s3">\cy</span>, [3,17] );</p>
<p class="p2"><br></p>
<p class="p3">b.add( <span class="s3">\bl</span>, [1,296] );</p>
<p class="p3">b.add( <span class="s3">\br</span>, [1,297] );</p>
<p class="p2"><br></p>
<p class="p3">b.add( <span class="s3">\bj1</span>, [1,298] );</p>
<p class="p3">b.add( <span class="s3">\bj2</span>, [1,299] );</p>
<p class="p3">)</p>
<p class="p2"><br></p>
<p class="p1">// Stop it:</p>
<p class="p3">a.debug_( <span class="s1">false</span> );</p>
<p class="p2"><br></p>
<p class="p1">// look at the map</p>
<p class="p3">b.map.postcs;</p>
<p class="p2"><br></p>
<p class="p1">// store it with a name:</p>
<p class="p3">b.save( <span class="s4">"Impact"</span> );</p>
<p class="p2"><br></p>
<p class="p1">// find matching, previously stored specs:</p>
<p class="p3">c = b.find;</p>
<p class="p2"><br></p>
<p class="p1">// load from file:</p>
<p class="p3">b.fromFile( <span class="s4">"Impact"</span> );</p>
<p class="p2"><br></p>
<p class="p1">// the loading and storing mechanism works across SC sessions, as they are stored to file, and GeneralHIDSpec loads the device info of all stored specs at startup of the language.<span class="Apple-converted-space"> </span></p>
<p class="p2"><br></p>
<p class="p1">/// A GeneralHIDDevice automatically has a spec, so we can access it even faster:</p>
<p class="p2"><br></p>
<p class="p3">a.spec;</p>
<p class="p2"><br></p>
<p class="p1">// there are shortcuts for the methods:</p>
<p class="p1"><span class="s2">add( key, slotids ) </span>// define a key to a slot</p>
<p class="p1"><span class="s2">at( key ) </span>// get the slot</p>
<p class="p1"><span class="s2">value( key ) </span>// get the value</p>
<p class="p3">value_( key, value ) <span class="s5">// set the value<span class="Apple-converted-space"> </span></span></p>
<p class="p3">action_( key, action ) <span class="s5">// set the action</span></p>
<p class="p1"><span class="s2">bus( key ) </span>// get the bus</p>
<p class="p3">createBus( key, server ) <span class="s5">// create the bus</span></p>
<p class="p3">freeBus( key ) <span class="s5">// free the bus</span></p>
<p class="p1"><span class="s2">createAllBuses( server ) </span>// create buses for all defined slots</p>
<p class="p1"><span class="s2">freeAllBuses </span>// free all buses</p>
<p class="p2"><br></p>
<p class="p1">// to find and set a spec:</p>
<p class="p3">a.findSpec;</p>
<p class="p3">a.setSpec( <span class="s4">"Impact"</span> );</p>
<p class="p2"><br></p>
<p class="p1">// post the mapping</p>
<p class="p3">a.spec.map</p>
<p class="p2"><br></p>
<p class="p1">// examples of use:</p>
<p class="p3">s = <span class="s1">Server</span>.local.boot;</p>
<p class="p2"><br></p>
<p class="p1">// create a bus</p>
<p class="p3">b.createBus( <span class="s3">\rx</span>, s );</p>
<p class="p3">b.createBus( <span class="s3">\b1</span>, s );</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p1">// simple example:</p>
<p class="p3">(</p>
<p class="p4">SynthDef<span class="s2">( </span><span class="s3">\hidbus_help</span><span class="s2">, { </span>|out=0,amp=0.5|</p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="s1">Out</span>.ar( out, <span class="s1">SinOsc</span>.ar( 300, 0, 0.2*(amp-0.5) ) );</p>
<p class="p3">}).load( s );</p>
<p class="p3">)</p>
<p class="p2"><br></p>
<p class="p3">x = <span class="s1">Synth</span>.new( <span class="s3">\hidbus_help</span> );</p>
<p class="p3">x.map( <span class="s3">\amp</span>, b.at( <span class="s3">\rx</span> ).bus );</p>
<p class="p3">x.free;</p>
<p class="p2"><br></p>
<p class="p1"><span class="s2">( </span>// a nicer version:</p>
<p class="p4">SynthDef<span class="s2">( </span><span class="s3">\hidbus_help</span><span class="s2">, { </span>|out=0,amp=0.5,amp2=0|</p>
<p class="p3"><span class="s1">Out</span>.ar( out, <span class="s1">SinOsc</span>.ar( 300, 0, 0.2*(amp-0.5).lag( 0.1 ) * amp2.lag(0.01,0.99)</p>
<p class="p3">) );</p>
<p class="p3">}).load( s );</p>
<p class="p3">)</p>
<p class="p2"><br></p>
<p class="p3">x = <span class="s1">Synth</span>.new( <span class="s3">\hidbus_help</span> );</p>
<p class="p3">x.map( <span class="s3">\amp</span>, b.at( <span class="s3">\rx</span> ).bus );</p>
<p class="p3">x.map( <span class="s3">\amp2</span>, b.at( <span class="s3">\b1</span> ).bus );</p>
<p class="p3">x.free;</p>
<p class="p2"><br></p>
<p class="p1"><span class="s2">( </span>// an even nicer version:</p>
<p class="p4">SynthDef<span class="s2">( </span><span class="s3">\hidbus_help</span><span class="s2">, { </span>|out=0,freqadd=0,amp=0,fmmul=200|</p>
<p class="p3"><span class="s1">Out</span>.ar( out, <span class="s1">SinOsc</span>.ar( 300 + (freqadd.lag(0.2,1)*fmmul), 0, 0.2*amp.lag</p>
<p class="p3">(0.01,0.99) ) );</p>
<p class="p3">}).load( s );</p>
<p class="p3">)</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p1">// if you want to have buses for all the things defined in the spec, you can use:</p>
<p class="p3">b.createAllBuses( s );</p>
<p class="p2"><br></p>
<p class="p3">(</p>
<p class="p3">x = [ <span class="s1">Synth</span>.new( <span class="s3">\hidbus_help</span> ), <span class="s1">Synth</span>.new( <span class="s3">\hidbus_help</span> ) ];</p>
<p class="p3">x[0].map( <span class="s3">\freqadd</span>, b.bus( <span class="s3">\ly</span> ) );</p>
<p class="p3">x[0].map( <span class="s3">\amp</span>, b.bus( <span class="s3">\b6</span> ) );</p>
<p class="p2"><br></p>
<p class="p3">x[1].map( <span class="s3">\freqadd</span>, b.bus( <span class="s3">\lx</span> ) );</p>
<p class="p3">x[1].map( <span class="s3">\amp</span>, b.bus( <span class="s3">\b7</span> ) );</p>
<p class="p2"><br></p>
<p class="p3">y = [ <span class="s1">Synth</span>.new( <span class="s3">\hidbus_help</span>, [<span class="s3">\fmmul</span>,400] ), <span class="s1">Synth</span>.new( <span class="s3">\hidbus_help</span>, [<span class="s3">\fmmul</span>,400] ) ];</p>
<p class="p3">y[0].map( <span class="s3">\freqadd</span>, b.bus( <span class="s3">\ry</span> ) );</p>
<p class="p3">y[0].map( <span class="s3">\amp</span>, b.bus( <span class="s3">\b5</span> ) );</p>
<p class="p2"><br></p>
<p class="p3">y[1].map( <span class="s3">\freqadd</span>, b.bus( <span class="s3">\rx</span> ) );</p>
<p class="p3">y[1].map( <span class="s3">\amp</span>, b.bus( <span class="s3">\b6</span> ) );</p>
<p class="p3">)</p>
<p class="p2"><br></p>
<p class="p1">// see what's going on on the server</p>
<p class="p3">s.queryAllNodes( <span class="s1">true</span> );</p>
<p class="p2"><br></p>
<p class="p1">// free the synths</p>
<p class="p3">y.do{ <span class="s1">|it|</span> it.free; }; x.do{ <span class="s1">|it|</span> it.free; };<span class="Apple-converted-space"> </span></p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p1">// To free all buses</p>
<p class="p3">b.freeAllBuses;</p>
<p class="p2"><br></p>
<p class="p1">// Close the device after use:</p>
<p class="p2"><br></p>
<p class="p3">a.close;</p>
<p class="p2"><br></p>
<p class="p3"><span class="s1">GeneralHID</span>.stopEventLoop</p>
<p class="p2"><br></p>
</body>
</html>

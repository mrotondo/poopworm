<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<title></title>
<meta name="Generator" content="Cocoa HTML Writer">
<meta name="CocoaVersion" content="1038.25">
<style type="text/css">
p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; min-height: 12.0px}
p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; color: #0000ee}
p.p4 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
p.p5 {margin: 0.0px 0.0px 0.0px 57.0px; text-indent: -57.0px; font: 12.0px Helvetica}
p.p6 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Helvetica}
p.p7 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco}
p.p8 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #bf0000}
p.p9 {margin: 0.0px 0.0px 0.0px 57.0px; text-indent: -57.0px; font: 14.0px Helvetica}
p.p10 {margin: 0.0px 0.0px 0.0px 57.0px; text-indent: -57.0px; font: 12.0px Helvetica; min-height: 14.0px}
p.p11 {margin: 0.0px 0.0px 0.0px 57.0px; text-indent: -57.0px; font: 9.0px Monaco; min-height: 12.0px}
p.p12 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #007300}
p.p13 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #0000bf}
p.p14 {margin: 0.0px 0.0px 0.0px 57.0px; text-indent: -57.0px; font: 14.0px Helvetica; min-height: 17.0px}
p.p15 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #bf0000; min-height: 12.0px}
p.p16 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #0000ee}
p.p17 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #0000bf; min-height: 12.0px}
span.s1 {font: 18.0px Helvetica}
span.s2 {font: 9.0px Monaco}
span.s3 {color: #000000}
span.s4 {text-decoration: underline}
span.s5 {color: #0000bf}
span.s6 {text-decoration: underline ; color: #0000bf}
span.s7 {color: #1034f0}
span.s8 {color: #007300}
span.s9 {color: #bf0000}
span.s10 {color: #606060}
span.Apple-tab-span {white-space:pre}
</style>
</head>
<body>
<p class="p1"><span class="s1"><b>Pdef<span class="Apple-tab-span">	</span></b></span><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><b>stream reference definition</b></p>
<p class="p2"><br></p>
<p class="p3"><span class="s3"><b>Inherits from:<span class="Apple-converted-space"> </span></b> <a href="../../../Core/Object.html"><span class="s4">Object</span></a> : <a href="../../../Core/Kernel/AbstractFunction.html"><span class="s4">AbstractFunction</span></a> : <a href="../../../Streams-Patterns-Events/Patterns/Pattern.html"><span class="s4">Pattern</span></a> : <a href="PatternProxy.html"><span class="s4">PatternProxy</span></a> : <a href="TaskProxy.html"><span class="s4">TaskProxy</span></a> : <a href="EventPatternProxy.html"><span class="s4">EventPatternProxy</span></a></span></p>
<p class="p4"><br></p>
<p class="p1">Pdef is a class that provides an interface to its superclass <a href="EventPatternProxy.html"><span class="s5">EventPatternProxy</span></a>, keeping a reference to a stream that can be replaced while playing. One pattern may be used in many streams in different places. A change in the pattern definition propagates through all streams.</p>
<p class="p4"><br></p>
<p class="p1"><b>Pdef(key)</b> returns the instance<span class="Apple-converted-space"> </span></p>
<p class="p1"><b>Pdef(key, pat)</b> stores the pattern and returns the instance, like <a href="Tdef.html"><span class="s5">Tdef</span></a> and <a href="../nodeproxy/Ndef.html"><span class="s5">Ndef</span></a>.</p>
<p class="p4"><br></p>
<p class="p1">It can be used to store event Patterns globally. Changes in this global library have immediate effect.</p>
<p class="p4"><br></p>
<p class="p1">For <b>non-event patterns</b> <a href="Pdefn.html"><span class="s6">Pdefn</span></a> is used instead.</p>
<p class="p5">For another use of Pdef see also <a href="../tutorials/recursive_phrasing.html"><span class="s5">recursive_phrasing</span></a></p>
<p class="p1">Graphical overview over all current Pdefs: <a href="../extras/PdefAllGui.html"><span class="s5">PdefAllGui</span></a></p>
<p class="p1">Overview: <a href="../JITLib.html"><span class="s7">JITLib</span></a></p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p6"><b>First Example</b></p>
<p class="p4"><br></p>
<p class="p7"><span class="Apple-tab-span">	</span>s.boot;</p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p7"><span class="Apple-tab-span">	</span><span class="s5">Pdef</span>(<span class="s8">\x</span>, <span class="s5">Pbind</span>(<span class="s8">\note</span>, <span class="s5">Pbrown</span>(0, 6, 0.1, <span class="s5">inf</span>)));</p>
<p class="p7"><span class="Apple-tab-span">	</span><span class="s5">Pdef</span>(<span class="s8">\x</span>).quant = 0; <span class="s9">// no waiting.</span></p>
<p class="p7"><span class="Apple-tab-span">	</span><span class="s5">Pbindf</span>(<span class="s5">Pdef</span>(<span class="s8">\x</span>), <span class="s8">\dur</span>, 0.03).play;</p>
<p class="p7"><span class="Apple-tab-span">	</span><span class="s5">Pbindf</span>(<span class="s5">Pdef</span>(<span class="s8">\x</span>), <span class="s8">\dur</span>, 0.1, <span class="s8">\ctranspose</span>, 15).play;</p>
<p class="p7"><span class="Apple-tab-span">	</span><span class="s5">Pbindf</span>(<span class="s5">Pdef</span>(<span class="s8">\x</span>), <span class="s8">\dur</span>, 0.3, <span class="s8">\ctranspose</span>, 2).play;</p>
<p class="p8"><span class="s3"><span class="Apple-tab-span">	</span></span>// now change the definition</p>
<p class="p7"><span class="Apple-tab-span">	</span><span class="s5">Pdef</span>(<span class="s8">\x</span>, <span class="s5">Pbind</span>(<span class="s8">\note</span>, <span class="s5">Pseq</span>([0, 3, 5, 7, 9, 11], <span class="s5">inf</span>)));</p>
<p class="p7"><span class="Apple-tab-span">	</span><span class="s5">Pdef</span>(<span class="s8">\x</span>, <span class="s5">Pbind</span>(<span class="s8">\freq</span>, <span class="s5">Pseq</span>([1000, 1923, 245.2, 1718] / 1.2 + 0.1, <span class="s5">inf</span>)));</p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p9"><b>Creation / Class Methods</b></p>
<p class="p10"><br></p>
<p class="p5"><span class="Apple-tab-span">	</span><b>*new(key, pattern)</b></p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Store the pattern in a global dictionary under key, replacing its pattern with the new one.</p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>If the pattern is a <b>function</b>, Pdef creates a <a href="../../../Streams-Patterns-Events/Patterns/PlazyEnvir.html"><span class="s5">PlazyEnvir</span></a> internall that dynamically creates the pattern returned from the function, applying the arguments from the inevent.</p>
<p class="p10"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p5"><span class="Apple-tab-span">	</span><b>*new(key)</b></p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Access the pattern at that key (if none is given, a default silent event is created)</p>
<p class="p10"><span class="Apple-tab-span">	</span></p>
<p class="p5"><span class="Apple-tab-span">	</span><b>*default</b></p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Default source, if none is given. The default is an Event.silent of 1.0 beat duration.</p>
<p class="p10"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p5"><span class="Apple-tab-span">	</span><b>*removeAll</b></p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Remove all proxies from the global dictionary (*<b>all</b>)</p>
<p class="p10"><span class="Apple-tab-span">	</span></p>
<p class="p5"><span class="Apple-tab-span">	</span><b>*clear</b></p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Clear all proxies, setting their source to silence.</p>
<p class="p10"><span class="Apple-tab-span">	</span></p>
<p class="p5"><span class="Apple-tab-span">	</span><b>*all</b></p>
<p class="p5"><b><span class="Apple-tab-span">	</span>*all_(envir)</b></p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Set or return the environment (<a href="../../../Collections/IdentityDictionary.html"><span class="s5">IdentityDictionary</span></a>) that stores all Pdefs.</p>
<p class="p10"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p10"><br></p>
<p class="p10"><span class="Apple-tab-span">	</span></p>
<p class="p6"><b>Changing the definition / setting the source</b></p>
<p class="p1">One pattern may have many streams in different places. A change in the pattern definition Pdef propagates through all streams. The change does not have to be immediate - there is a scheme to schedule when the change becomes effective: a <b>quant</b> and <b>clock</b> (like elsewhere) and a <b>condition</b>.</p>
<p class="p10"><br></p>
<p class="p10"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p5"><span class="Apple-tab-span">	</span><b>quant_(beats)</b></p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Set the quantisation time for beat accurate scheduling.<span class="Apple-converted-space"> </span></p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>quant can be an array <b>[quant, phase, timingOffset, outset]</b>, or just <b>[quant, phase] </b>etc.</p>
<p class="p10"><span class="Apple-tab-span">	</span></p>
<p class="p5"><span class="Apple-tab-span">	</span>*<b>defaultQuant_(beats)</b></p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Set the default quantisation for new instances (default: 1.0)</p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>This can be an array<span class="Apple-converted-space">  </span>[quant, phase, timingOffset, outset]</p>
<p class="p10"><span class="Apple-tab-span">	</span></p>
<p class="p5"><span class="Apple-tab-span">	</span><b>condition_(func)</b></p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Provide a condition under which the pattern is switched when a new one is inserted.</p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>The stream value and a count value is passed into the function.</p>
<p class="p10"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p5"><span class="Apple-tab-span">	</span><b>count(n)</b></p>
<p class="p5"><b><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></b>Create and update condition that simply counts up to n and switches the pattern then</p>
<p class="p10"><br></p>
<p class="p5"><span class="Apple-tab-span">	</span><b>reset</b><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Switch the pattern immediately (stuck conditions can be subverted by this).</p>
<p class="p10"><br></p>
<p class="p5"><span class="Apple-tab-span">	</span><b>fadeTime_(beats)</b></p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>When the synthdefs that are used contain an \amp control, the patterns are replaced by crossfading the previous with the new over this time (in beats)</p>
<p class="p10"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p5"><span class="Apple-tab-span">	</span><b>envir_(event)</b></p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Set the event for the Pdef. It is used to filter the incoming stream before it is<span class="Apple-converted-space">  </span>passed to the source pattern.<span class="Apple-converted-space">  </span>This is similar to <a href="../nodeproxy/NodeProxy.html"><span class="s5">NodeProxy</span></a>-nodeMap. When set for the first time, the pattern is rebuilt.</p>
<p class="p10"><span class="Apple-tab-span">	</span></p>
<p class="p5"><span class="Apple-tab-span">	</span><b>set(key, val, key2, val2, ...)</b></p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Set arguments in the default event. If there is none, it is created and the pattern is rebuilt.</p>
<p class="p10"><span class="Apple-tab-span">	</span></p>
<p class="p5"><span class="Apple-tab-span">	</span><b>map(key, pdefKey, key, pdefKey ...)</b></p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Map Pdefn to the keys in the event.</p>
<p class="p10"><span class="Apple-tab-span">	</span></p>
<p class="p5"><span class="Apple-tab-span">	</span><b>clear</b></p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Set the source to nil</p>
<p class="p10"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p5"><span class="Apple-tab-span">	</span><b>endless</b></p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Returns a Prout that plays the proxy endlessly, replacing <b>nil</b> with a <b>default</b> value (silent event). This allows to create streams that idle on until a new pattern is inserted.</p>
<p class="p10"><br></p>
<p class="p10"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p10"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p10"><br></p>
<p class="p9"><b>Pdef as stream reference</b></p>
<p class="p1">A single Pdef may serve as a definition for multiple streams. These methods show how to fork off separate streams from one instance. Even if they run in different contexts, their definition may still be changed.<span class="Apple-tab-span">	</span></p>
<p class="p4"><span class="Apple-tab-span">	</span></p>
<p class="p5"><span class="Apple-tab-span">	</span><b>fork(clock, quant, event)</b></p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Play an independent stream in parallel.</p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><b>quant </b>can be an array of [quant, phase, offset], or a <a href="../../../Scheduling/Quant.html"><span class="s5">Quant</span></a> value.</p>
<p class="p10"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p5"><span class="Apple-tab-span">	</span><b>embed(val)</b><span class="Apple-tab-span">	</span></p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Pass a value (typically an <b>event</b>) into the pattern inval, and embed the Pdef in the stream.</p>
<p class="p10"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p5"><span class="Apple-tab-span">	</span><b>embedInStream(inval)</b></p>
<p class="p5"><b><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></b>just like any pattern, embeds itself in stream</p>
<p class="p10"><span class="Apple-tab-span">	</span></p>
<p class="p10"><br></p>
<p class="p10"><br></p>
<p class="p9"><b>Pdef as EventStreamPlayer</b></p>
<p class="p1">For live coding, each Pdef also may control one instance that plays one stream off it. This is an EventStreamPlayer, accessible in the instance variable <b>player</b>.</p>
<p class="p10"><br></p>
<p class="p5"><span class="Apple-tab-span">	</span><b>play(clock, protoEvent, quant)</b></p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Starts the Pdef and creates a player.<span class="Apple-converted-space"> </span></p>
<p class="p5"><b><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>quant </b>can be an array of [quant, phase, offset] or a <a href="../../../Scheduling/Quant.html"><span class="s5">Quant</span></a> value.</p>
<p class="p10"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p5"><span class="Apple-tab-span">	</span><b>stop</b></p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Stops the player</p>
<p class="p10"><span class="Apple-tab-span">	</span></p>
<p class="p5"><span class="Apple-tab-span">	</span><b>player</b><span class="Apple-tab-span">	</span></p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Return the current player (if the Pdef is simply used in other streams this is nil)</p>
<p class="p10"><br></p>
<p class="p5"><span class="Apple-tab-span">	</span><b>pause / resume / reset / mute / unmute</b></p>
<p class="p5"><b><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></b>Perform this method on the player.</p>
<p class="p10"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p5"><span class="Apple-tab-span">	</span><b>isPlaying</b><span class="Apple-converted-space"> </span></p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Returns true if player is running. If a Pdef is playing and its stream ends, it will schedule a stream for playing<b> as soon as a new one is assigned to it</b>. If it is stopped by <b>stop</b>, it won't.</p>
<p class="p10"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p10"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p10"><span class="Apple-tab-span">	</span></p>
<p class="p11"><br></p>
<p class="p10"><br></p>
<p class="p9"><b>Example: Pdef as stream reference</b></p>
<p class="p10"><br></p>
<p class="p11"><br></p>
<p class="p11"><br></p>
<p class="p7">(</p>
<p class="p7"><span class="s5">SynthDef</span>(<span class="s10">"Pdefhelp"</span>, { <span class="s5">arg</span> out, freq, sustain=1, amp=1, pan;</p>
<p class="p7"><span class="Apple-tab-span">	</span><span class="s5">var</span> env, u=1;</p>
<p class="p7"><span class="Apple-tab-span">	</span>env = <span class="s5">EnvGen</span>.kr(<span class="s5">Env</span>.perc(0.03, sustain), 1, doneAction:2);</p>
<p class="p7"><span class="Apple-tab-span">	</span>3.do { <span class="s5">var</span> d; d = exprand(0.01, 1); u = <span class="s5">SinOsc</span>.ar(d * 300, u, rrand(0.1,1.2) * d, 1) };</p>
<p class="p7"><span class="Apple-tab-span">	</span><span class="s5">Out</span>.ar(out, <span class="s5">Pan2</span>.ar(<span class="s5">SinOsc</span>.ar(u + 1 * freq, 0, amp * env), pan));</p>
<p class="p2"><br></p>
<p class="p7">}).store;</p>
<p class="p7">)</p>
<p class="p7">s.boot;</p>
<p class="p2"><br></p>
<p class="p12"><span class="s5">Pdef</span><span class="s3">(</span>\metronom<span class="s3">, </span><span class="s5">Pbind</span><span class="s3">(</span>\instrument<span class="s3">, </span>\Pdefhelp<span class="s3">, </span>\dur<span class="s3">, 1, </span>\degree<span class="s3">, 16, </span>\legato<span class="s3">, 0.1)).play;</span></p>
<p class="p2"><br></p>
<p class="p7">x = <span class="s5">Pseq</span>([<span class="s5">Pdef</span>(<span class="s8">\a</span>), <span class="s5">Pdef</span>(<span class="s8">\b</span>), <span class="s5">Pdef</span>(<span class="s8">\c</span>)], <span class="s5">inf</span>).play;</p>
<p class="p2"><br></p>
<p class="p7"><span class="s5">Pdef</span>(<span class="s8">\a</span>, <span class="s5">Pbind</span>(<span class="s8">\instrument</span>, <span class="s8">\Pdefhelp</span>, <span class="s8">\dur</span>, 0.25, <span class="s8">\degree</span>, <span class="s5">Pseq</span>(#[0, 5, 4, 3])));</p>
<p class="p7"><span class="s5">Pdef</span>(<span class="s8">\b</span>, <span class="s5">Pbind</span>(<span class="s8">\instrument</span>, <span class="s8">\Pdefhelp</span>, <span class="s8">\dur</span>, 0.125, <span class="s8">\degree</span>, <span class="s5">Pseq</span>(#[7, 8, 7, 8])));</p>
<p class="p7"><span class="s5">Pdef</span>(<span class="s8">\c</span>, <span class="s5">Pbind</span>(<span class="s8">\instrument</span>, <span class="s8">\Pdefhelp</span>, <span class="s8">\dur</span>, 0.25, <span class="s8">\degree</span>, <span class="s5">Pseq</span>(#[0, 1, 2], 2)));</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p7"><span class="s5">Pdef</span>(<span class="s8">\c</span>, <span class="s5">Pbind</span>(<span class="s8">\instrument</span>, <span class="s8">\Pdefhelp</span>, <span class="s8">\dur</span>, 0.25, <span class="s8">\degree</span>, <span class="s5">Pseq</span>(#[4, 3, 1, 2]*3)));</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p8">// infinite loops are scheduled (to ths clock's next beat by default) and released:</p>
<p class="p2"><br></p>
<p class="p7"><span class="s5">Pdef</span>(<span class="s8">\a</span>, <span class="s5">Pbind</span>(<span class="s8">\instrument</span>, <span class="s8">\Pdefhelp</span>, <span class="s8">\dur</span>, 0.753, <span class="s8">\degree</span>, <span class="s5">Pseq</span>(#[0, 5, 4, 3, 2], <span class="s5">inf</span>)));</p>
<p class="p7"><span class="s5">Pdef</span>(<span class="s8">\a</span>, <span class="s5">Pbind</span>(<span class="s8">\instrument</span>, <span class="s8">\Pdefhelp</span>, <span class="s8">\dur</span>, 0.125, <span class="s8">\degree</span>, <span class="s5">Pseq</span>(#[0, 5, 4, 3] + 1, 1)));</p>
<p class="p7"><span class="s5">Pdef</span>(<span class="s8">\a</span>, <span class="s5">Pbind</span>(<span class="s8">\instrument</span>, <span class="s8">\Pdefhelp</span>, <span class="s8">\dur</span>, 0.25, <span class="s8">\degree</span>, <span class="s5">Pseq</span>(#[0, 5, 4, 3] - 4, 1)));</p>
<p class="p2"><br></p>
<p class="p7"><span class="s5">Pdef</span>(<span class="s8">\a</span>, <span class="s5">Pbind</span>(<span class="s8">\instrument</span>, <span class="s8">\Pdefhelp</span>, <span class="s8">\dur</span>, 0.125, <span class="s8">\degree</span>, <span class="s5">Pseq</span>(#[0, 5] - 1, 1)));</p>
<p class="p7"><span class="s5">Pdef</span>(<span class="s8">\a</span>, <span class="s5">Pbind</span>(<span class="s8">\instrument</span>, <span class="s8">\Pdefhelp</span>, <span class="s8">\dur</span>, 0.753, <span class="s8">\degree</span>, <span class="s5">Pshuf</span>(#[0, 5, 4, 3, 2], <span class="s5">inf</span>)));</p>
<p class="p2"><br></p>
<p class="p7">x.stop;</p>
<p class="p12"><span class="s5">Pdef</span><span class="s3">(</span>\metronom<span class="s3">).stop;</span></p>
<p class="p2"><br></p>
<p class="p8">// Pdef can be used in multiple patterns:</p>
<p class="p2"><br></p>
<p class="p7">(</p>
<p class="p7">x = <span class="s5">Ppar</span>([</p>
<p class="p13"><span class="s3"><span class="Apple-tab-span">	</span></span>Pbindf<span class="s3">(</span>Pn<span class="s3">(</span>Pdef<span class="s3">(</span><span class="s8">\a</span><span class="s3">), </span>inf<span class="s3">),</span></p>
<p class="p7"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s8">\gtranspose</span>, <span class="s5">Pstutter</span>(8, <span class="s5">Pseq</span>(#[0, 2, 0, 3],<span class="s5">inf</span>))</p>
<p class="p7"><span class="Apple-tab-span">	</span>),</p>
<p class="p13"><span class="s3"><span class="Apple-tab-span">	</span></span>Pbindf<span class="s3">(</span>Pn<span class="s3">(</span>Pdef<span class="s3">(</span><span class="s8">\a</span><span class="s3">), </span>inf<span class="s3">),</span></p>
<p class="p7"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s8">\gtranspose</span>, <span class="s5">Pstutter</span>(8, <span class="s5">Pseq</span>(#[7, 4, 0, 3],<span class="s5">inf</span>)),<span class="Apple-converted-space"> </span></p>
<p class="p7"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s8">\dur</span>, 0.6</p>
<p class="p7"><span class="Apple-tab-span">	</span>),</p>
<p class="p13"><span class="s3"><span class="Apple-tab-span">	</span></span>Pbindf<span class="s3">(</span>Pn<span class="s3">(</span>Pdef<span class="s3">(</span><span class="s8">\a</span><span class="s3">), </span>inf<span class="s3">),</span></p>
<p class="p7"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s8">\degree</span>, <span class="s5">Pseq</span>(#[0, 5, 4, 3, 2, 3, 2], 1)</p>
<p class="p7"><span class="Apple-tab-span">	</span>)</p>
<p class="p7">]).play;</p>
<p class="p7">)</p>
<p class="p2"><br></p>
<p class="p7"><span class="s5">Pdef</span>(<span class="s8">\a</span>, <span class="s5">Pbind</span>(<span class="s8">\instrument</span>, <span class="s8">\Pdefhelp</span>, <span class="s8">\dur</span>, 0.1, <span class="s8">\degree</span>, <span class="s5">Pseq</span>(#[0, 1, 0, 1, 2], <span class="s5">inf</span>)));</p>
<p class="p2"><br></p>
<p class="p12"><span class="s5">Pdef</span><span class="s3">(</span>\a<span class="s3">, </span><span class="s5">Pbind</span><span class="s3">(</span>\instrument<span class="s3">, </span>\Pdefhelp<span class="s3">, </span>\dur<span class="s3">, 0.2, </span>\degree<span class="s3">, </span><span class="s5">Pseq</span><span class="s3">([0, 4], </span><span class="s5">inf</span><span class="s3">)));</span></p>
<p class="p2"><br></p>
<p class="p12"><span class="s5">Pdef</span><span class="s3">(</span>\a<span class="s3">, </span><span class="s5">Pbind</span><span class="s3">(</span>\instrument<span class="s3">, </span>\Pdefhelp<span class="s3">, </span>\dur<span class="s3">, 1, </span>\degree<span class="s3">, </span><span class="s5">Pseq</span><span class="s3">([0, 4], </span><span class="s5">inf</span><span class="s3">)));</span></p>
<p class="p2"><br></p>
<p class="p7"><span class="s5">Pdef</span>(<span class="s8">\a</span>, <span class="s5">Pbind</span>(<span class="s8">\instrument</span>, <span class="s8">\Pdefhelp</span>, <span class="s8">\dur</span>, 0.2, <span class="s8">\degree</span>, <span class="s5">Pseq</span>([0, 4, <span class="s5">Prand</span>([6, 8b],2)], <span class="s5">inf</span>)));</p>
<p class="p2"><br></p>
<p class="p7"><span class="s5">Pdef</span>(<span class="s8">\a</span>, <span class="s5">Pbind</span>(<span class="s8">\instrument</span>, <span class="s8">\Pdefhelp</span>, <span class="s8">\dur</span>, 0.1, <span class="s8">\degree</span>, <span class="s5">Pseq</span>(#[0, 1b, 1, 2b, 2, 3, 4b, 4, 5], <span class="s5">inf</span>)));</p>
<p class="p2"><br></p>
<p class="p8">// using a fade time, the above changes are crossfaded</p>
<p class="p7"><span class="s5">Pdef</span>(<span class="s8">\a</span>).fadeTime = 2;</p>
<p class="p2"><br></p>
<p class="p7"><span class="s5">Pdef</span>(<span class="s8">\a</span>, <span class="s5">Pbind</span>(<span class="s8">\instrument</span>, <span class="s8">\Pdefhelp</span>, <span class="s8">\dur</span>, 0.2, <span class="s8">\degree</span>, <span class="s5">Pseq</span>([0, 4, <span class="s5">Prand</span>([6, 8b],2)], <span class="s5">inf</span>)));</p>
<p class="p2"><br></p>
<p class="p8">// ...</p>
<p class="p2"><br></p>
<p class="p8"><span class="s5">Pdef</span><span class="s3">(</span><span class="s8">\a</span><span class="s3">).set(</span><span class="s8">\detune</span><span class="s3">, -50); </span>// set environment</p>
<p class="p7"><span class="s5">Pdef</span>(<span class="s8">\a</span>).set(<span class="s8">\detune</span>, 0);</p>
<p class="p2"><br></p>
<p class="p7">x.stop;</p>
<p class="p2"><br></p>
<p class="p14"><br></p>
<p class="p9"><b>Example: Pdef as EventStreamPlayer</b></p>
<p class="p15"><br></p>
<p class="p2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p7">(</p>
<p class="p8">// load a synthdef</p>
<p class="p7">s.boot;</p>
<p class="p13">SynthDef<span class="s3">(</span><span class="s10">"gpdef"</span><span class="s3">,<span class="Apple-converted-space"> </span></span></p>
<p class="p7"><span class="Apple-tab-span">	</span>{ <span class="s5">arg</span> out=0, freq=440, sustain=0.05, amp=0.1, pan;</p>
<p class="p7"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s5">var</span> env;</p>
<p class="p7"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>env = <span class="s5">EnvGen</span>.kr(<span class="s5">Env</span>.perc(0.01, sustain), doneAction:2) * amp;</p>
<p class="p7"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s5">Out</span>.ar(out, <span class="s5">Pan2</span>.ar(<span class="s5">SinOsc</span>.ar(freq, 0, env), pan))</p>
<p class="p7"><span class="Apple-tab-span">	</span>}).store;</p>
<p class="p7">)</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p8"><span class="s5">Pdef</span><span class="s3">(</span><span class="s8">\x</span><span class="s3">); </span>// creates a Pdef with a default pattern.</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p8"><span class="s5">Pdef</span><span class="s3">(</span><span class="s8">\x</span><span class="s3">).play; </span>// play it. A silent resting pattern is used.</p>
<p class="p8"><span class="s5">Pdef</span><span class="s3">(</span><span class="s8">\y</span><span class="s3">).play; </span>// play a second one (automatically instantiated)</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p8">// assign various patterns to it:</p>
<p class="p2"><br></p>
<p class="p12"><span class="s5">Pdef</span><span class="s3">(</span>\x<span class="s3">, </span><span class="s5">Pbind</span><span class="s3">(</span>\dur<span class="s3">, 0.25, </span>\instrument<span class="s3">, </span>\gpdef<span class="s3">));<span class="Apple-converted-space"> </span></span></p>
<p class="p7"><span class="s5">Pdef</span>(<span class="s8">\x</span>, <span class="s5">Pbind</span>(<span class="s8">\dur</span>, 0.25, <span class="s8">\degree</span>, <span class="s5">Pseq</span>([3, 4, 5b, 6], <span class="s5">inf</span>), <span class="s8">\instrument</span>, <span class="s8">\gpdef</span>));</p>
<p class="p7"><span class="s5">Pdef</span>(<span class="s8">\x</span>, <span class="s5">Pbind</span>(<span class="s8">\dur</span>, 0.25, <span class="s8">\degree</span>, <span class="s5">Pseq</span>([3, 4, 5b, 6]+1, <span class="s5">inf</span>), <span class="s8">\instrument</span>, <span class="s8">\gpdef</span>));</p>
<p class="p7"><span class="s5">Pdef</span>(<span class="s8">\y</span>, <span class="s5">Pbind</span>(<span class="s8">\dur</span>, 0.25, <span class="s8">\degree</span>, <span class="s5">Pseq</span>([3, 4, 5b, 6]-1, <span class="s5">inf</span>), <span class="s8">\instrument</span>, <span class="s8">\gpdef</span>));</p>
<p class="p7"><span class="s5">Pdef</span>(<span class="s8">\y</span>, <span class="s5">Pbind</span>(<span class="s8">\dur</span>, 0.25, <span class="s8">\degree</span>, <span class="s5">Pseq</span>([3, 4, 5b]-2, <span class="s5">inf</span>), <span class="s8">\instrument</span>, <span class="s8">\gpdef</span>));</p>
<p class="p2"><br></p>
<p class="p8">// using fadeTime:</p>
<p class="p2"><br></p>
<p class="p7"><span class="s5">Pdef</span>(<span class="s8">\y</span>).fadeTime = 8.0;</p>
<p class="p7"><span class="s5">Pdef</span>(<span class="s8">\y</span>, <span class="s5">Pbind</span>(<span class="s8">\dur</span>, 0.125, <span class="s8">\degree</span>, <span class="s5">Pseq</span>([3, 4, 5b, 6]+4.rand, <span class="s5">inf</span>), <span class="s8">\instrument</span>, <span class="s8">\gpdef</span>));</p>
<p class="p7"><span class="s5">Pdef</span>(<span class="s8">\y</span>, <span class="s5">Pbind</span>(<span class="s8">\dur</span>, 0.25, <span class="s8">\degree</span>, <span class="s5">Pseq</span>([3, 4, 5b, 6]-2, <span class="s5">inf</span>), <span class="s8">\instrument</span>, <span class="s8">\gpdef</span>));</p>
<p class="p2"><br></p>
<p class="p7">(</p>
<p class="p13">Pdef<span class="s3">(</span><span class="s8">\x</span><span class="s3">, </span>Pbind<span class="s3">(</span></p>
<p class="p7"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s8">\dur</span>, 1 / 6,<span class="Apple-converted-space"> </span></p>
<p class="p7"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s8">\degree</span>, <span class="s5">Pseq</span>([3, 4, <span class="s5">Prand</span>([8, 2, 3, 9, 10],1) - 5, 6]+1, <span class="s5">inf</span>),<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="s3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\instrument<span class="s3">, </span>\gpdef</p>
<p class="p7"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>)</p>
<p class="p7"><span class="Apple-tab-span">	</span>);</p>
<p class="p7">)</p>
<p class="p7">(</p>
<p class="p13">Pdef<span class="s3">(</span><span class="s8">\x</span><span class="s3">, </span>Pbind<span class="s3">(</span></p>
<p class="p7"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s8">\dur</span>, 0.25,<span class="Apple-converted-space"> </span></p>
<p class="p7"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s8">\degree</span>, <span class="s5">Pseq</span>([3, 4, <span class="s5">Prand</span>([8, 2, 3, 9, 10],1), 6], <span class="s5">inf</span>),<span class="Apple-converted-space"> </span></p>
<p class="p12"><span class="s3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>\instrument<span class="s3">, </span>\gpdef<span class="s3">)</span></p>
<p class="p7"><span class="Apple-tab-span">	</span>);</p>
<p class="p7">)</p>
<p class="p7"><span class="s5">Pdef</span>(<span class="s8">\x</span>).stop;</p>
<p class="p2"><br></p>
<p class="p7"><span class="s5">Pdef</span>(<span class="s8">\x</span>).play;</p>
<p class="p2"><br></p>
<p class="p8">// tempo change</p>
<p class="p7"><span class="s5">TempoClock</span>.default.tempo = 1.3;</p>
<p class="p7"><span class="s5">Pdef</span>(<span class="s8">\y</span>, <span class="s5">Pbind</span>(<span class="s8">\dur</span>, 0.25, <span class="s8">\degree</span>, <span class="s5">Pseq</span>([3, 4, 5, 6]+1, <span class="s5">inf</span>), <span class="s8">\instrument</span>, <span class="s8">\gpdef</span>));</p>
<p class="p2"><br></p>
<p class="p8">// drop in ending patterns</p>
<p class="p2"><br></p>
<p class="p7"><span class="s5">Pdef</span>(<span class="s8">\x</span>, <span class="s5">Pbind</span>(<span class="s8">\dur</span>, 0.25, <span class="s8">\degree</span>, <span class="s5">Pseq</span>([3, [7,4], 5, 6]-2), <span class="s8">\instrument</span>, <span class="s8">\gpdef</span>));</p>
<p class="p7"><span class="s5">Pdef</span>(<span class="s8">\x</span>, <span class="s5">Pbind</span>(<span class="s8">\dur</span>, 0.125, <span class="s8">\degree</span>, <span class="s5">Pseq</span>([3, [7,4], 5, 4]-3), <span class="s8">\instrument</span>, <span class="s8">\gpdef</span>));</p>
<p class="p7"><span class="s5">Pdef</span>(<span class="s8">\x</span>, <span class="s5">Pbind</span>(<span class="s8">\dur</span>, 0.35, <span class="s8">\degree</span>, <span class="s5">Pseq</span>([3, [7,4], 5, 4, 3]-3), <span class="s8">\instrument</span>, <span class="s8">\gpdef</span>));</p>
<p class="p7"><span class="s5">Pdef</span>(<span class="s8">\x</span>, <span class="s5">Pbind</span>(<span class="s8">\dur</span>, 0.25, <span class="s8">\degree</span>, <span class="s5">Pshuf</span>([3, [7,4], 5, 6]-2), <span class="s8">\instrument</span>, <span class="s8">\gpdef</span>));</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p8">// clear all.</p>
<p class="p7"><span class="s5">Pdef</span>(<span class="s8">\x</span>).clear;<span class="Apple-converted-space"> </span></p>
<p class="p7"><span class="s5">Pdef</span>(<span class="s8">\y</span>).clear;<span class="Apple-converted-space"> </span></p>
<p class="p7"><span class="s5">TempoClock</span>.default.tempo = 1.0;</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p8">// GUI example: see also<span class="Apple-converted-space"> </span></p>
<p class="p16"><span class="s4"><a href="../extras/PdefAllGui.html">PdefAllGui</a></span><span class="s3">(18);</span></p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p9"><b>Example: Recursion</b></p>
<p class="p4"><br></p>
<p class="p1">Pdefs can be used recursively under the condition that the stream call structure allows it.</p>
<p class="p1">a structure like the following works:</p>
<p class="p4"><br></p>
<p class="p2"><br></p>
<p class="p12"><span class="s5">Pdef</span><span class="s3">(</span>\x<span class="s3">, </span><span class="s5">Pseq</span><span class="s3">([</span><span class="s5">Pbind</span><span class="s3">(</span>\instrument<span class="s3">, </span>\gpdef<span class="s3">), </span><span class="s5">Pdef</span><span class="s3">(</span>\x<span class="s3">)], </span><span class="s5">inf</span><span class="s3">));<span class="Apple-converted-space"> </span></span></p>
<p class="p7"><span class="s5">Pdef</span>(<span class="s8">\x</span>).play;</p>
<p class="p4"><br></p>
<p class="p1">but the following would crash, because .embedInStream is called recursively with no limit:</p>
<p class="p4"><br></p>
<p class="p8">// Pdef(\y, Pseq([Pdef(\y), Pbind(\instrument, \gpdef)], inf));</p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p9"><b>Example: Quantizing and outset</b></p>
<p class="p4"><br></p>
<p class="p1">When quantizing to a larger number of beats, the changes become very slow if one has to wait for the next beat. Providing an <b>outset</b> quant value is a way to make the change so that it appears as if it had been done at the previous grid point already. The stream is fast forwarded to the current position relative to the quant grid.</p>
<p class="p1">Providing a number larger than zero, the next possible quant point is used as outset.</p>
<p class="p4"><br></p>
<p class="p1">For example, if quant is 32, and one has just missed the first beat when changing the pattern,</p>
<p class="p1">one has to wait for 32 beats until the change happens. Using an outset of 1, it is assumed that you had already</p>
<p class="p1">changed the pattern at the first beat, the stream is fast forwarded to the time it would be at now if you had done so. The new pattern is inserted at the next beat (outset=1).</p>
<p class="p4"><br></p>
<p class="p1"><b>quant can be: [quant, phase, timingOffset, outset]</b></p>
<p class="p4"><br></p>
<p class="p1"><b>Note:</b> This fast forwarding might create a cpu peak if the pattern is very complex/fast or</p>
<p class="p1">quant is very long. This is hard to avoid, so it simply has to be taken into account.</p>
<p class="p4"><br></p>
<p class="p2"><br></p>
<p class="p8">// examples</p>
<p class="p7">(</p>
<p class="p7"><span class="s5">Pdef</span>(<span class="s8">\x</span>).quant_([8, 0, 0, 1]);</p>
<p class="p7"><span class="s5">Pdef</span>(<span class="s8">\y</span>).quant_([8, 0.5, 0, 1]); <span class="s9">// phase: half a beat</span></p>
<p class="p7"><span class="s5">Pdef</span>(<span class="s8">\x</span>).play;</p>
<p class="p7"><span class="s5">Pdef</span>(<span class="s8">\y</span>).play;</p>
<p class="p7">)</p>
<p class="p2"><br></p>
<p class="p7"><span class="s5">Pdef</span>(<span class="s8">\x</span>, <span class="s5">Pbind</span>(<span class="s8">\degree</span>, <span class="s5">Pseq</span>((0..7)+2, <span class="s5">inf</span>)));</p>
<p class="p7"><span class="s5">Pdef</span>(<span class="s8">\y</span>, <span class="s5">Pbind</span>(<span class="s8">\degree</span>, <span class="s5">Pseq</span>((0..7)-2, <span class="s5">inf</span>)));</p>
<p class="p7"><span class="s5">Pdef</span>(<span class="s8">\x</span>, <span class="s5">Pbind</span>(<span class="s8">\degree</span>, <span class="s5">Pseq</span>((0..7)+2, <span class="s5">inf</span>), <span class="s8">\dur</span>, 0.5));</p>
<p class="p7"><span class="s5">Pdef</span>(<span class="s8">\y</span>, <span class="s5">Pbind</span>(<span class="s8">\degree</span>, <span class="s5">Pseq</span>((0..7).scramble-2, <span class="s5">inf</span>), <span class="s8">\dur</span>, 0.25, <span class="s8">\legato</span>, 0.3));</p>
<p class="p7"><span class="s5">Pdef</span>(<span class="s8">\x</span>, <span class="s5">Pbind</span>(<span class="s8">\degree</span>, <span class="s5">Pseq</span>((0..7), <span class="s5">inf</span>)));</p>
<p class="p2"><br></p>
<p class="p7"><span class="s5">Pdef</span>(<span class="s8">\x</span>, <span class="s5">Pbind</span>(<span class="s8">\degree</span>, <span class="s5">Pseq</span>([ 1, 5, 6, 7, 0, 3, 2, 4 ], <span class="s5">inf</span>), <span class="s8">\dur</span>, 1));</p>
<p class="p7"><span class="s5">Pdef</span>(<span class="s8">\x</span>, <span class="s5">Pbind</span>(<span class="s8">\degree</span>, <span class="s5">Pseq</span>([ 0, 2, 2, 4, 0, 4, 0, 4 ], <span class="s5">inf</span>), <span class="s8">\dur</span>, 1));</p>
<p class="p2"><br></p>
<p class="p8"><span class="s5">Pdef</span><span class="s3">(</span><span class="s8">\x</span><span class="s3">).quant_([8, 1/3, 0, 1]); </span>// phase: 1/6 beat relative to y</p>
<p class="p7"><span class="s5">Pdef</span>(<span class="s8">\x</span>, <span class="s5">Pbind</span>(<span class="s8">\degree</span>, <span class="s5">Pseq</span>([ 1, 1, 1, 7, 0, 2, 2, 4 ], <span class="s5">inf</span>), <span class="s8">\legato</span>, 0.1));</p>
<p class="p7"><span class="s5">Pdef</span>(<span class="s8">\x</span>, <span class="s5">Pbind</span>(<span class="s8">\degree</span>, <span class="s5">Pseq</span>([ 3, 3, 3, 4b ], <span class="s5">inf</span>), <span class="s8">\legato</span>, 0.1));</p>
<p class="p7"><span class="s5">Pdef</span>(<span class="s8">\y</span>, <span class="s5">Pbind</span>(<span class="s8">\degree</span>, <span class="s5">Pseq</span>((0..7).scramble-4, <span class="s5">inf</span>), <span class="s8">\dur</span>, 0.25, <span class="s8">\legato</span>, 0.3));</p>
<p class="p2"><br></p>
<p class="p4"><br></p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p8">// some testing</p>
<p class="p7">(</p>
<p class="p8"><span class="s5">var</span><span class="s3"> quant = #[8, 0, 0, 1]; </span>// quantise to 8 beats, no phase, insert quant to 1 beat</p>
<p class="p7"><span class="s5">Pdef</span>(<span class="s8">\x</span>).quant_(quant);</p>
<p class="p7"><span class="s5">Pdef</span>(<span class="s8">\x</span>).play;</p>
<p class="p7"><span class="s5">Routine</span> { loop { 8.do { <span class="s5">|i|</span> (<span class="s10">"uhr:"</span>+i).postln; 1.wait } } }.play(quant:quant);</p>
<p class="p7"><span class="s5">Pbind</span>(<span class="s8">\degree</span>, <span class="s5">Pseq</span>((0..7), <span class="s5">inf</span>)).play(quant:quant);</p>
<p class="p7">)</p>
<p class="p2"><br></p>
<p class="p7"><span class="s5">Pdef</span>(<span class="s8">\x</span>, <span class="s5">Pbind</span>(<span class="s8">\degree</span>, <span class="s5">Pseq</span>((0..7)+2, <span class="s5">inf</span>)).trace(<span class="s8">\degree</span>));</p>
<p class="p7"><span class="s5">Pdef</span>(<span class="s8">\x</span>, <span class="s5">Pbind</span>(<span class="s8">\degree</span>, <span class="s5">Pseq</span>((0..7), <span class="s5">inf</span>) + [0, 3]).trace(<span class="s8">\degree</span>));</p>
<p class="p7"><span class="s5">Pdef</span>(<span class="s8">\x</span>, <span class="s5">Pbind</span>(<span class="s8">\degree</span>, <span class="s5">Pseq</span>((0..7), <span class="s5">inf</span>) + [0, 6], <span class="s8">\dur</span>, 0.5).trace(<span class="s8">\degree</span>));</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p7"><span class="s5">Pdef</span>(<span class="s8">\x</span>).fadeTime = 8;</p>
<p class="p2"><br></p>
<p class="p7"><span class="s5">Pdef</span>(<span class="s8">\x</span>, <span class="s5">Pbind</span>(<span class="s8">\degree</span>, <span class="s5">Pseq</span>((0..7), <span class="s5">inf</span>)).trace(<span class="s8">\degree</span>));</p>
<p class="p7"><span class="s5">Pdef</span>(<span class="s8">\x</span>, <span class="s5">Pbind</span>(<span class="s8">\degree</span>, <span class="s5">Pseq</span>((0..7).reverse, <span class="s5">inf</span>) + [0, 6], <span class="s8">\dur</span>, 0.5));</p>
<p class="p2"><br></p>
<p class="p7"><span class="s5">Pdef</span>(<span class="s8">\x</span>).fadeTime = <span class="s5">nil</span>;</p>
<p class="p7"><span class="s5">Pdef</span>(<span class="s8">\x</span>).quant = 1;</p>
<p class="p2"><br></p>
<p class="p7"><span class="s5">Pdef</span>(<span class="s8">\x</span>, <span class="s5">Pbind</span>(<span class="s8">\degree</span>, <span class="s5">Pseq</span>((0..7), <span class="s5">inf</span>)).trace(<span class="s8">\degree</span>));</p>
<p class="p2"><br></p>
<p class="p7"><span class="s5">Pdef</span>(<span class="s8">\x</span>).quant = 8;</p>
<p class="p7"><span class="s5">Pdef</span>(<span class="s8">\x</span>, <span class="s5">Pbind</span>(<span class="s8">\degree</span>, <span class="s5">Pseq</span>((0..7), <span class="s5">inf</span>)).trace(<span class="s8">\degree</span>));</p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p9"><b>Example: Update condition</b></p>
<p class="p4"><br></p>
<p class="p1">In order to be able to switch to a new pattern under a certain condition, the instance variable</p>
<p class="p1"><b><i>condition</i></b> can be set to a function that returns a boolean. Value and a count index are passed to the function.</p>
<p class="p1">The condition is always valid for the <b><i>next pattern</i></b> inserted. For stuck conditions, the <b>reset</b> message can be used.</p>
<p class="p4"><br></p>
<p class="p1">As counting up (such as <i>"every nth event, a swap can happen"</i>) is a common task, there is a method for this,</p>
<p class="p1">called <b>count(n).</b></p>
<p class="p4"><br></p>
<p class="p2"><br></p>
<p class="p7"><span class="s5">Pdef</span>(<span class="s8">\x</span>).play;</p>
<p class="p8"><span class="s5">Pdef</span><span class="s3">(</span><span class="s8">\x</span><span class="s3">).quant = 0; </span>// we don't want quant here.</p>
<p class="p7"><span class="s5">Pdef</span>(<span class="s8">\x</span>, <span class="s5">Pbind</span>(<span class="s8">\degree</span>, <span class="s5">Pseq</span>((0..5), <span class="s5">inf</span>), <span class="s8">\dur</span>, 0.3)).condition_({ <span class="s5">|val, i|</span> i.postln % 6 == 0 });</p>
<p class="p7"><span class="s5">Pdef</span>(<span class="s8">\x</span>, <span class="s5">Pbind</span>(<span class="s8">\degree</span>, <span class="s5">Pseq</span>((0..7) + 5.rand, <span class="s5">inf</span>), <span class="s8">\dur</span>, 0.3)).condition_({ <span class="s5">|val, i|</span> (i % 8).postln == 0 });</p>
<p class="p2"><br></p>
<p class="p8">// the above is equivalent to:</p>
<p class="p7"><span class="s5">Pdef</span>(<span class="s8">\x</span>, <span class="s5">Pbind</span>(<span class="s8">\degree</span>, <span class="s5">Pseq</span>((0..7) + 5.rand, <span class="s5">inf</span>), <span class="s8">\dur</span>, 0.3)).count(8);</p>
<p class="p2"><br></p>
<p class="p8">// the value that is sent in is the event, so decisions can be made dependent on the event's fields</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p1"><b>reset</b></p>
<p class="p17"><span class="Apple-converted-space"> </span></p>
<p class="p8">// reset to change immediately:</p>
<p class="p7"><span class="s5">Pdef</span>(<span class="s8">\x</span>).reset;</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p4"><br></p>
<p class="p4"><br></p>
</body>
</html>

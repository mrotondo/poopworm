<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<title></title>
<meta name="Generator" content="Cocoa HTML Writer">
<meta name="CocoaVersion" content="949.35">
<style type="text/css">
p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; min-height: 12.0px}
p.p4 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco}
p.p5 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Helvetica}
p.p6 {margin: 0.0px 0.0px 0.0px 57.0px; text-indent: -57.0px; font: 9.0px Monaco; min-height: 12.0px}
p.p7 {margin: 0.0px 0.0px 0.0px 57.0px; text-indent: -57.0px; font: 12.0px Helvetica}
p.p8 {margin: 0.0px 0.0px 0.0px 57.0px; text-indent: -57.0px; font: 12.0px Helvetica; min-height: 14.0px}
p.p9 {margin: 0.0px 0.0px 0.0px 85.0px; text-indent: -85.0px; font: 12.0px Helvetica}
p.p10 {margin: 0.0px 0.0px 0.0px 85.0px; text-indent: -85.0px; font: 12.0px Helvetica; min-height: 14.0px}
p.p11 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #000000}
p.p12 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #606060}
p.p13 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Helvetica; min-height: 17.0px}
p.p14 {margin: 0.0px 0.0px 0.0px 57.0px; text-indent: -57.0px; font: 14.0px Helvetica}
p.p15 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #000000; min-height: 12.0px}
p.p16 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #bf0000}
p.p17 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #007300}
p.p18 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #0000bf}
span.s1 {font: 18.0px Helvetica}
span.s2 {color: #0000ff}
span.s3 {color: #1235e8}
span.s4 {text-decoration: underline}
span.s5 {color: #56682c}
span.s6 {color: #6f7178}
span.s7 {color: #000000}
span.s8 {color: #0000bf}
span.s9 {color: #606060}
span.s10 {font: 14.0px Helvetica}
span.s11 {color: #007300}
span.s12 {color: #bf0000}
span.Apple-tab-span {white-space:pre}
</style>
</head>
<body>
<p class="p1"><span class="s1"><b>SCQuartzComposerView<span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></b></span><b>view for rendering Quartz Composer Compositions</b><span class="s1"><b><span class="Apple-tab-span">	</span></b></span></p>
<p class="p2"><br></p>
<p class="p1"><b>Inherits from: </b><a href="../../../Core/Object.html"><span class="s2"><b>Object</b></span></a><b> : </b><a href="../SCView.html"><span class="s2"><b>SCView</b></span></a></p>
<p class="p3"><br></p>
<p class="p1">SCQuartzComposerView allows for the rendering of Quartz Composer Compositions within the standard OSX SC GUI system. Quartz Composer is a visual programming environment for processing and rendering graphical data, which is distributed free of charge as part of Apple's XCode Development Tools. QC is highly optimised to work with the OSX graphics system, and in general should be more efficient than <a href="../../Main-GUI/Pen.html"><span class="s3">Pen</span></a>. For more information on QC see: <span class="s4">http://developer.apple.com/documentation/GraphicsImaging/Conceptual/QuartzComposer/index.html</span></p>
<p class="p3"><br></p>
<p class="p1">You can access input and output ports using the methods <b>setInputValue</b>, <b>getInputValue</b> and <b>getOutputValue</b>, or (do to a slight of hand in the implementation, using the port keys as getters and setters directly. The following two lines of code are thus equivalent:</p>
<p class="p2"><br></p>
<p class="p4">myQCView.setInputValue(<span class="s5">\valueIn</span>, 1);</p>
<p class="p4">myQCView.valueIn = 1;</p>
<p class="p3"><br></p>
<p class="p3"><br></p>
<p class="p5"><b>Creation / Class Methods</b></p>
<p class="p6"><br></p>
<p class="p7"><b><span class="Apple-tab-span">	</span>*new (parent, bounds)</b></p>
<p class="p8"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p7"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><b>parent </b>- </span>The parent view.</p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><b>bounds </b>- An instance of <a href="../../../Geometry/Rect.html"><span class="s6">Rect</span></a>, </span>or </span>a <a href="../../../Geometry/Point.html"><span class="s6">Point</span></a> indicating width@height.</p>
<p class="p10"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>(</p>
<p class="p12"><span class="s7"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>w = </span><span class="s8">SCWindow</span><span class="s7">(</span>"Simple QC Test"<span class="s7">).front;</span></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>b = <span class="s8">SCButton</span>(w, <span class="s8">Rect</span>(0, 0, 150, 20))</p>
<p class="p12"><span class="s7"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>.states_([[</span>"pick another QC file"<span class="s7">]])</span></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>.action_({ <span class="s8">File</span>.openDialog(<span class="s9">""</span>, { <span class="s8">|path|</span> m.path_(path) }) });</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>m = <span class="s8">SCQuartzComposerView</span>(w, <span class="s8">Rect</span>(0,20,400, 260));</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>m.path = <span class="s8">Document</span>.current.path.dirname ++ <span class="s9">"/Cells.qtz"</span>;</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>)</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>m.start;</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>m.stop;</p>
<p class="p3"><br></p>
<p class="p5"><b>Instance Methods</b></p>
<p class="p13"><b></b><br></p>
<p class="p7"><b><span class="Apple-tab-span">	</span>path</b></p>
<p class="p7"><b><span class="Apple-tab-span">	</span>path_ (argpath)</b></p>
<p class="p8"><b><span class="Apple-tab-span">	</span></b></p>
<p class="p7"><b><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></b>Returns the path of the currently loaded composition as a <a href="../../../Collections/String.html"><span class="s2">String</span></a>, or loads a new QC composition from the file at the location specified by the String <b>argpath</b>.</p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><b>argpath </b>- A file path as a <a href="../../../Collections/String.html"><span class="s2">String</span></a>.</p>
<p class="p8"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p7"><b><span class="Apple-tab-span">	</span>inputKeys</b></p>
<p class="p8"><b><span class="Apple-tab-span">	</span></b></p>
<p class="p7"><b><span class="Apple-tab-span">	</span></b><span class="Apple-tab-span">	</span>Returns an Array of Symbols corresponding to the keys of the currently loaded composition's input ports.</p>
<p class="p8"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p7"><b><span class="Apple-tab-span">	</span>outputKeys</b></p>
<p class="p8"><b><span class="Apple-tab-span">	</span></b><span class="Apple-tab-span">	</span></p>
<p class="p7"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Returns an Array of Symbols corresponding to the keys of the currently loaded composition's output ports.<span class="Apple-tab-span">	</span></p>
<p class="p8"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p7"><b><span class="Apple-tab-span">	</span>start</b></p>
<p class="p8"><b><span class="Apple-tab-span">	</span></b></p>
<p class="p7"><b><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></b>Start rendering the loaded composition.</p>
<p class="p8"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p7"><b><span class="Apple-tab-span">	</span>stop</b></p>
<p class="p8"><b><span class="Apple-tab-span">	</span></b></p>
<p class="p7"><b><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></b>Stop rendering the loaded composition.</p>
<p class="p8"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p7"><b><span class="Apple-tab-span">	</span>setInputValue (key, value)</b></p>
<p class="p8"><b><span class="Apple-tab-span">	</span></b></p>
<p class="p7"><b><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></b>Set the value of an input port at key.</span></p>
<p class="p8"><br></p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><b>key </b>- A String or Symbol matching the port's key.</p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><b>value </b>- The type of value must correspond to the type of the port, but Floats, Integers, and Booleans are converted if needed. (true = 1, false = 0)</p>
<p class="p8"><br></p>
<p class="p7"><b><span class="Apple-tab-span">	</span>getInputValue (key)</b></p>
<p class="p8"><b><span class="Apple-tab-span">	</span></b></p>
<p class="p7"><b><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></b>Get the current value of an input port. The type of object returned will correspond to the port's type.</p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><b>key </b>- A String or Symbol matching the port's key.</p>
<p class="p10"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p7"><b><span class="Apple-tab-span">	</span>getOutputValue (key)</b></p>
<p class="p8"><b><span class="Apple-tab-span">	</span></b></p>
<p class="p7"><b><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></b>Get the current value of an output port. The type of object returned will correspond to the port's type.</p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><b>key </b>- A String or Symbol matching the port's key.</p>
<p class="p10"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p7"><b><span class="Apple-tab-span">	</span>maxFPS_ (rate)</b></p>
<p class="p8"><b><span class="Apple-tab-span">	</span></b></p>
<p class="p7"><b><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></b>Set the maximum frames per second at which the composition will render.</p>
<p class="p9"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><b>rate </b>- A value of 0 indicates no limit.</p>
<p class="p10"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p7"><b><span class="Apple-tab-span">	</span>openInQC</b></p>
<p class="p8"><b><span class="Apple-tab-span">	</span></b></p>
<p class="p7"><b><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></b>Open the currently loaded composition in Quartz Composer. You will need to reload the composition into the view before any saved changes take effect.</p>
<p class="p8"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p14"><b>Subclassing and Internal Methods</span></b></p>
<p class="p7"><span class="s10"><span class="Apple-tab-span">	</span></span>The following methods are usually not used directly or are called by a primitive. Programmers can still call or override these as needed.</span></p>
<p class="p6"><br></p>
<p class="p7"><b><span class="Apple-tab-span">	</span>doesNotUnderstand (selector, args)</b></p>
<p class="p6"><br></p>
<p class="p14"><b>Examples</b></p>
<p class="p15"><br></p>
<p class="p15"><br></p>
<p class="p16">////////// Simple example</p>
<p class="p11">(</p>
<p class="p12"><span class="s7">w = </span><span class="s8">SCWindow</span><span class="s7">(</span>"Simple QC Test"<span class="s7">).front;</span></p>
<p class="p11">b = <span class="s8">SCButton</span>(w, <span class="s8">Rect</span>(0, 0, 150, 20))</p>
<p class="p12"><span class="s7"><span class="Apple-tab-span">	</span>.states_([[</span>"pick another QC file"<span class="s7">]])</span></p>
<p class="p11"><span class="Apple-tab-span">	</span>.action_({ <span class="s8">File</span>.openDialog(<span class="s9">""</span>, { <span class="s8">|path|</span> m.path_(path) }) });</p>
<p class="p11">m = <span class="s8">SCQuartzComposerView</span>(w, <span class="s8">Rect</span>(0,20,400, 260));</p>
<p class="p11">m.path = <span class="s8">Document</span>.current.path.dirname ++ <span class="s9">"/Cells.qtz"</span>;</p>
<p class="p11">)</p>
<p class="p11">m.start;</p>
<p class="p11">m.stop;</p>
<p class="p15"><br></p>
<p class="p16">////////// Set and get inputs and outputs</p>
<p class="p11">(</p>
<p class="p11">w = <span class="s8">SCWindow</span>(<span class="s9">"SCTV"</span>).front;</p>
<p class="p11">m = <span class="s8">SCQuartzComposerView</span>(w, <span class="s8">Rect</span>(0,20,400, 260));</p>
<p class="p11">m.path = <span class="s8">Document</span>.current.path.dirname ++ <span class="s9">"/SCQuartzComposerViewTest.qtz"</span>;</p>
<p class="p11">m.start;</p>
<p class="p11">)</p>
<p class="p15"><br></p>
<p class="p16">// get the names of input and output keys</p>
<p class="p11">m.inputKeys;</p>
<p class="p11">m.outputKeys;</p>
<p class="p16"><span class="s7">m.openInQC; </span>// you can see the published inputs and outputs in the composition</p>
<p class="p15"><br></p>
<p class="p16">// You can access input and output ports using setInputValue, getInputValue and getOutputValue</p>
<p class="p16">// or directly using the keys as getters and setters</p>
<p class="p11">m.setInputValue(<span class="s11">\direction</span>, 1);</p>
<p class="p11">m.direction = 0;</p>
<p class="p11">m.direction;</p>
<p class="p16"><span class="s7">m.fontSize; </span>// font size in QC Units</p>
<p class="p11">m.fontSize_(0.1);</p>
<p class="p15"><br></p>
<p class="p11">m.string_(<span class="s9">"SCTV"</span>).fontName_(<span class="s9">"Courier"</span>);</p>
<p class="p11">m.startColor_(<span class="s8">Color</span>.green);</p>
<p class="p11">m.billboardEnable_(<span class="s8">false</span>);</p>
<p class="p11">m.billboardEnable_(<span class="s8">true</span>);</p>
<p class="p11">m.maxFPS_(5.0);</p>
<p class="p11">m.maxFPS_(10);</p>
<p class="p11">m.maxFPS_(0.0); <span class="s12">// no max</span></p>
<p class="p15"><br></p>
<p class="p16"><span class="s7">m.getOutputValue(</span><span class="s11">\interpResult</span><span class="s7">); </span>// current rotation of the text in degrees</p>
<p class="p11">m.interpResult;</p>
<p class="p16"><span class="s7">m.systemTime; </span>// current System Time published in the composition</p>
<p class="p16"><span class="s7">m.endColor.class; </span>// yup, it's a SC Color object</p>
<p class="p11">m.endColor == <span class="s8">Color</span>.white;</p>
<p class="p15"><br></p>
<p class="p11">(</p>
<p class="p16">// probably more efficient to do this in QC, but...</p>
<p class="p11">{</p>
<p class="p11">c = <span class="s8">Color</span>.blue;</p>
<p class="p11">100.do({ m.startColor_(c = c.vary(1)); 0.1.wait; });</p>
<p class="p11">}.fork(<span class="s8">AppClock</span>);</p>
<p class="p11">)</p>
<p class="p15"><br></p>
<p class="p11">m.bounds = <span class="s8">Rect</span>(100, 20, 200, 260);</p>
<p class="p15"><br></p>
<p class="p11">m.stop;</p>
<p class="p15"><br></p>
<p class="p16">///////////// Fullscreen</p>
<p class="p15"><br></p>
<p class="p11">(</p>
<p class="p11">w = <span class="s8">SCWindow</span>(<span class="s9">"SCTV"</span>, <span class="s8">Rect</span>(0,0,360, 280), border: <span class="s8">false</span>).front;</p>
<p class="p11">b = <span class="s8">SCButton</span>(w, <span class="s8">Rect</span>(0, 0, 150, 20))</p>
<p class="p11"><span class="Apple-tab-span">	</span>.states_([[<span class="s9">"Close Me"</span>]])</p>
<p class="p11"><span class="Apple-tab-span">	</span>.action_({w.close});</p>
<p class="p11">m = <span class="s8">SCQuartzComposerView</span>(w, <span class="s8">Rect</span>(0,20,360, 260));</p>
<p class="p11">m.path = <span class="s8">Document</span>.current.path.dirname ++ <span class="s9">"/SCQuartzComposerViewTest.qtz"</span>;</p>
<p class="p15"><br></p>
<p class="p11">m.resize = 5;</p>
<p class="p11">m.start;</p>
<p class="p11">)</p>
<p class="p15"><br></p>
<p class="p11">w.fullScreen;</p>
<p class="p15"><br></p>
<p class="p15"><br></p>
<p class="p16">////////// Structure test</p>
<p class="p11">(</p>
<p class="p11">w = <span class="s8">SCWindow</span>(<span class="s9">"SCTV"</span>).front;</p>
<p class="p11">m = <span class="s8">SCQuartzComposerView</span>(w, <span class="s8">Rect</span>(0,20,400, 260));</p>
<p class="p12"><span class="s7">m.path = </span><span class="s8">Document</span><span class="s7">.current.path.dirname ++ </span>"/SCQuartzComposerViewStructureTest.qtz"<span class="s7">;</span></p>
<p class="p11">m.start;</p>
<p class="p11">)</p>
<p class="p15"><br></p>
<p class="p11">m.inputKeys;</p>
<p class="p11">m.outputKeys;</p>
<p class="p16"><span class="s7">m.openInQC; </span>// Take a look at the various inputs and outputs. Select and mouseover for key names.</p>
<p class="p15"><br></p>
<p class="p16">// set several parameters at once</p>
<p class="p16">// [background color, num copies, scale, string, [font size in QC units, font]]</p>
<p class="p11">m.structure = [<span class="s8">Color</span>.red, 4, 1.5, <span class="s9">"Hello"</span>, [0.2, <span class="s9">"Courier"</span>]];</p>
<p class="p11">m.structure = [<span class="s8">Color</span>.red, 3, 1.5, <span class="s9">"World"</span>, [0.4, <span class="s9">"Arial"</span>]];</p>
<p class="p11">m.structure = [<span class="s8">Color</span>.red, 4, 0.1, <span class="s9">"!!"</span>, [0.7, <span class="s9">"Times"</span>]];</p>
<p class="p11">m.structure = [<span class="s8">Color</span>.black, 4, 0.1, <span class="s9">"!!!"</span>, [0.6, <span class="s9">"Courier"</span>]];</p>
<p class="p11">m.dictStructure = <span class="s8">IdentityDictionary</span>[<span class="s11">\x</span>-&gt;(-0.4), <span class="s11">\y</span>-&gt;0.4];</p>
<p class="p15"><br></p>
<p class="p16">// get stuff out</p>
<p class="p16">// QCView stores all structures as instances of NSCFDictionary internally</p>
<p class="p16">// so all structure outputs are instances of IdentityDictionary</p>
<p class="p11">m.structure = [<span class="s8">Color</span>.blue, 4, 0.2, <span class="s9">"Gruess Welt"</span>, [0.12, <span class="s9">"Zapfino"</span>]];</p>
<p class="p16"><span class="s7">x = m.stringStruct; </span>// separates the string into components</p>
<p class="p17"><span class="s7">x[</span>\component_1<span class="s7">];</span></p>
<p class="p15"><br></p>
<p class="p16">// pass something through</p>
<p class="p11">m.arbStructIn = [<span class="s9">"foo"</span>, <span class="s9">"bar"</span>, [<span class="s9">"foobar"</span>]]; <span class="s12">// array in</span></p>
<p class="p16"><span class="s7">x = m.arbStructOut; </span>// IdentDict out with Integer Symbols as keys</p>
<p class="p11">x[\0];</p>
<p class="p11">x[\2][\0];</p>
<p class="p11">(</p>
<p class="p16">// convert to array</p>
<p class="p11">y = <span class="s8">Array</span>.newClear(x.size);</p>
<p class="p11">x.keysValuesDo({<span class="s8">|i, elem|</span> y[i.asInteger] = elem});</p>
<p class="p11">y.postln;</p>
<p class="p11">)</p>
<p class="p15"><br></p>
<p class="p16">// use QC to concat the strings)</p>
<p class="p11">m.stringConcatIn = [<span class="s9">"foo"</span>, <span class="s9">"bar"</span>]; <span class="s12">// array in</span></p>
<p class="p11">x = m.stringConcatOut; <span class="s12">// String Out</span></p>
<p class="p15"><br></p>
<p class="p15"><br></p>
<p class="p16">////////// Control some audio: Stupid Pan Example</p>
<p class="p15"><br></p>
<p class="p11">(</p>
<p class="p11">w = <span class="s8">SCWindow</span>(<span class="s9">"Stupid Pan Example"</span>, <span class="s8">Rect</span>(0,20,600, 150)).front;</p>
<p class="p11">m = <span class="s8">SCQuartzComposerView</span>(w, <span class="s8">Rect</span>(0,20,600, 100));</p>
<p class="p11">m.path = <span class="s8">Document</span>.current.path.dirname ++ <span class="s9">"/Stupid Pan.qtz"</span>;</p>
<p class="p11">m.resize = 5;</p>
<p class="p11">m.start;</p>
<p class="p11">)</p>
<p class="p15"><br></p>
<p class="p11">s.boot;</p>
<p class="p16">// use mouse to set pan position</p>
<p class="p11">(</p>
<p class="p11">{</p>
<p class="p11">loop({</span></p>
<p class="p11">{ <span class="s8">Pan2</span>.ar(<span class="s8">Saw</span>.ar(mul: 0.1) * <span class="s8">EnvGen</span>.ar(<span class="s8">Env</span>.perc, timeScale: 4, doneAction: 2), m.x_pos) }.play;</span></p>
<p class="p11">1.wait;</span></p>
<p class="p11">});</p>
<p class="p11">}.fork(<span class="s8">AppClock</span>);</p>
<p class="p11">)</p>
<p class="p15"><br></p>
<p class="p16">////////// Sonogram</p>
<p class="p15"><br></p>
<p class="p16">// could be better optimised, but proves the concept</p>
<p class="p11">(</p>
<p class="p11">w = <span class="s8">SCWindow</span>(<span class="s9">"Sonogram"</span>, <span class="s8">Rect</span>(0,20,600, 300)).front;</p>
<p class="p11">m = <span class="s8">SCQuartzComposerView</span>(w, <span class="s8">Rect</span>(0,20,600, 256));</p>
<p class="p11">m.path = <span class="s8">Document</span>.current.path.dirname ++ <span class="s9">"/SCQCsonogramCount2.qtz"</span>;</p>
<p class="p11">m.start;</p>
<p class="p11">m.setInputValue(<span class="s11">\framesPerView</span>, 300);</p>
<p class="p11">m.setInputValue(<span class="s11">\magnitudes</span>, (0, 0.01..1));</p>
<p class="p11">)</p>
<p class="p15"><br></p>
<p class="p11">s.boot;</p>
<p class="p11">b = <span class="s8">Buffer</span>.alloc(s,256);</p>
<p class="p11">(</p>
<p class="p11">a = { <span class="s8">FFT</span>(b, <span class="s8">LFSaw</span>.ar(4000)); 0.0 }.play; <span class="s12">// sawtooth</span></p>
<p class="p15"><br></p>
<p class="p11">p = 0.25; i = 0;</p>
<p class="p16">//m.setInputValue(\period, p);</p>
<p class="p16">//m.maxFPS_(p.reciprocal * 2);</p>
<p class="p11"><span class="s8">SystemClock</span>.sched(0.0, {</p>
<p class="p11">b.getn(0, 256, { <span class="s8">arg</span> buf;</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="s8">var</span> z, x;</p>
<p class="p11"><span class="Apple-tab-span">	</span>z = buf.clump(2).flop;</p>
<p class="p11"><span class="Apple-tab-span">	</span>z = [<span class="s8">Signal</span>.newFrom(z[0]), <span class="s8">Signal</span>.newFrom(z[1])];</p>
<p class="p11"><span class="Apple-tab-span">	</span>x = <span class="s8">Complex</span>(z[0], z[1]);</p>
<p class="p16"><span class="s7"><span class="Apple-tab-span">	</span></span>//{m.setInputValue(\magnitudes, x.magnitude.resamp1(m.bounds.height * 0.5));}.defer</p>
<p class="p11"><span class="Apple-tab-span">	</span>{m.setInputValue(<span class="s11">\magnitudes</span>, x.magnitude * 0.025); m.setInputValue(<span class="s11">\count</span>, i);}.defer;</p>
<p class="p11"><span class="Apple-tab-span">	</span>i = i + 1;</p>
<p class="p11">}); p</p>
<p class="p11">});</p>
<p class="p11">)</p>
<p class="p15"><br></p>
<p class="p11">a.free;</p>
<p class="p11">a = { <span class="s8">FFT</span>(b, <span class="s8">Dust2</span>.ar(500) * 5); 0.0 }.play; <span class="s12">// Impulses</span></p>
<p class="p15"><br></p>
<p class="p11">a.free;</p>
<p class="p12"><span class="s7">c = </span><span class="s8">Buffer</span><span class="s7">.read(s, </span>"sounds/a11wlk01.wav"<span class="s7">);</span></p>
<p class="p11">(</p>
<p class="p11">m.setInputValue(<span class="s11">\framesPerView</span>, 50);</p>
<p class="p11">a = { <span class="s8">var</span> colum;</p>
<p class="p11"><span class="Apple-tab-span">	</span>colum = <span class="s8">PlayBuf</span>.ar(1, c, <span class="s8">BufRateScale</span>.kr(c) * <span class="s8">Line</span>.kr(1, 3, 20), loop: 1);</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="s8">FFT</span>(b, colum);</span></p>
<p class="p11"><span class="Apple-tab-span">	</span>colum</p>
<p class="p11">}.play;</p>
<p class="p11">)</p>
<p class="p15"><br></p>
<p class="p16">///////////// Cheap Level Meter</p>
<p class="p11">(</p>
<p class="p11">w = <span class="s8">SCWindow</span>(<span class="s9">"Level Meters"</span>, <span class="s8">Rect</span>(128, 64, 200, 400)).front;</p>
<p class="p15"><br></p>
<p class="p11">m = <span class="s8">SCQuartzComposerView</span>(w, <span class="s8">Rect</span>(20,20,50, 360));</p>
<p class="p11">n = <span class="s8">SCQuartzComposerView</span>(w, <span class="s8">Rect</span>(130,20,50, 360));</p>
<p class="p11">m.path = <span class="s8">Document</span>.current.path.dirname ++ <span class="s9">"/SCLevelMeter.qtz"</span>;</p>
<p class="p11">n.path = <span class="s8">Document</span>.current.path.dirname ++ <span class="s9">"/SCLevelMeter.qtz"</span>;</p>
<p class="p11">m.maxFPS_(20); n.maxFPS_(20);</p>
<p class="p11">m.start; n.start;</p>
<p class="p11">~meters = [m, n];</p>
<p class="p11">)</p>
<p class="p15"><br></p>
<p class="p11">s.boot;</p>
<p class="p15"><br></p>
<p class="p16">// MouseX controls noise amp</p>
<p class="p11">(</p>
<p class="p11">o = <span class="s8">OSCresponder</span>(s.addr, <span class="s11">'/tr'</span>, {<span class="s8">arg</span> time, resp, msg;</p>
<p class="p11"><span class="Apple-tab-span">	</span>{~meters[msg[2]].level = (msg[3] + 0.01).explin(0.01,1.01, 0, 1);}.defer;</p>
<p class="p11">}).add;</p>
<p class="p12"><span class="s7">b = </span><span class="s8">Buffer</span><span class="s7">.read(s, </span>"sounds/a11wlk01.wav"<span class="s7">);<span class="Apple-tab-span">	</span></span></p>
<p class="p11">a = { <span class="s8">var</span> colum, noise, imp, delimp;</p>
<p class="p11"><span class="Apple-tab-span">	</span>imp = <span class="s8">Impulse</span>.kr(20);</p>
<p class="p11"><span class="Apple-tab-span">	</span>delimp = <span class="s8">Delay1</span>.kr(imp);</p>
<p class="p11"><span class="Apple-tab-span">	</span>colum = <span class="s8">PlayBuf</span>.ar(1, b, <span class="s8">BufRateScale</span>.kr(b), loop: 1);</p>
<p class="p11"><span class="Apple-tab-span">	</span>noise = <span class="s8">PinkNoise</span>.ar(<span class="s8">MouseX</span>.kr);</p>
<p class="p16"><span class="s7"><span class="Apple-tab-span">	</span></span>// measure Peak</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="s8">SendTrig</span>.kr(imp, 0, <span class="s8">Peak</span>.ar(colum, delimp));</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="s8">SendTrig</span>.kr(imp, 1, <span class="s8">Peak</span>.ar(noise, delimp));</p>
<p class="p11"><span class="Apple-tab-span">	</span>[colum, noise];</p>
<p class="p11">}.play;</p>
<p class="p11">)</p>
<p class="p15"><br></p>
<p class="p11">a.free;</p>
<p class="p15"><br></p>
<p class="p15"><br></p>
<p class="p16">/// using an event type to control a QCView by patterns:</p>
<p class="p15"><br></p>
<p class="p11"><span class="s8">Event</span>.addEventType(<span class="s11">\quartz</span>, { <span class="s8">|server|</span></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="s8">var</span> latency = server.latency;</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="s8">var</span> view = ~view.postln;</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="s8">var</span> key = ~key, value = ~value;</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="s8">AppClock</span>.sched(latency, { view.postln; view.setInputValue(key, value) });</p>
<p class="p11">});</p>
<p class="p15"><br></p>
<p class="p15"><br></p>
<p class="p11">(</p>
<p class="p11">w = <span class="s8">SCWindow</span>(<span class="s9">"Level Meters"</span>, <span class="s8">Rect</span>(128, 64, 200, 400)).front;</p>
<p class="p15"><br></p>
<p class="p11">m = <span class="s8">SCQuartzComposerView</span>(w, <span class="s8">Rect</span>(20,20,50, 360));</p>
<p class="p12"><span class="s7">m.path = </span>"Help/GUI/Cocoa-GUI/SCQuartzComposerView/SCLevelMeter.qtz"<span class="s7">.standardizePath;</span></p>
<p class="p11">m.maxFPS_(20);</p>
<p class="p11">m.start;</p>
<p class="p11">)</p>
<p class="p15"><br></p>
<p class="p11">(</p>
<p class="p18">Pbind<span class="s7">(</span></p>
<p class="p17"><span class="s7"><span class="Apple-tab-span">	</span></span>\type<span class="s7">, </span>\quartz<span class="s7">,</span></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="s11">\view</span>, m,</p>
<p class="p17"><span class="s7"><span class="Apple-tab-span">	</span></span>\key<span class="s7">, </span>\level<span class="s7">,</span></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="s11">\value</span>, <span class="s8">Pwhite</span>(0, 1.0, <span class="s8">inf</span>).explin(0.01,1.01, 0, 1),</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="s11">\dur</span>, 0.1</p>
<p class="p11">).play;</p>
<p class="p11">)</p>
<p class="p15"><br></p>
<p class="p11">m.setInputValue(<span class="s11">\level</span>, 0.5);</p>
</body>
</html>
